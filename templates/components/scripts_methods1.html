methods: {
        getPageTitle() {
            const titles = {'dashboard': 'Dashboard','bot-activities': 'Bot Activities','profiles': 'Edge Profiles','listings': 'Vehicle Listings','add-listing': 'Add New Listing','media': 'Media Library','history': 'Upload History','deleted': 'Deleted Listings','schedule': 'Schedule'};
            return titles[this.activeTab] || 'Dashboard';
        },
        getPageSubtitle() {
            const subtitles = {'dashboard': 'Overview of your marketplace automation','bot-activities': 'Monitor bot status, logs, and activity history','profiles': 'Manage your Microsoft Edge profiles','listings': 'Manage your vehicle listings','add-listing': 'Create a new vehicle listing','media': 'Manage your media files in Google Drive','history': 'View upload history and statistics','deleted': 'Restore previously deleted listings','schedule': 'Manage scheduled posts'};
            return subtitles[this.activeTab] || '';
        },
        loadProfiles() {
            this.loadingProfiles = true;
            axios.get('/get_profiles').then(response => {
                if (response.data.status === 'success') { this.profiles = response.data.profiles; console.log('Loaded ' + this.profiles.length + ' profiles'); }
                else { this.showToast('error', response.data.message || 'Failed to load profiles'); }
            }).catch(error => { console.error('Error loading profiles:', error); this.showToast('error', 'Failed to load profiles'); }).finally(() => { this.loadingProfiles = false; });
        },
        addProfile() {
            if (!this.profileForm.profile_name || !this.profileForm.profile_path) { this.showToast('warning', 'Please fill in profile name and path'); return; }
            axios.post('/add_profile', this.profileForm).then(response => {
                if (response.data.status === 'success') { this.showDialog('success', 'Success!', 'Profile added!'); this.resetProfileForm(); this.loadProfiles(); }
                else { this.showDialog('error', 'Error', response.data.message || 'Failed to add profile'); }
            }).catch(error => { this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to add profile'); });
        },
        editProfileClick(profile) { this.editingProfile = profile.id; this.profileForm = { id: profile.id, profile_name: profile.profile_name, profile_path: profile.profile_path, location: profile.location || '' }; },
        cancelProfileEdit() { this.editingProfile = null; this.resetProfileForm(); },
        updateProfile() {
            if (!this.profileForm.profile_name || !this.profileForm.profile_path) { this.showToast('warning', 'Please fill in profile name and path'); return; }
            axios.post('/update_profile', this.profileForm).then(response => {
                if (response.data.status === 'success') { this.showDialog('success', 'Updated!', 'Profile updated!'); this.cancelProfileEdit(); this.loadProfiles(); }
                else { this.showDialog('error', 'Error', response.data.message || 'Failed to update profile'); }
            }).catch(error => { this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to update profile'); });
        },
        async confirmDeleteProfile(profile) {
            const confirmed = await this.showDialog('confirm', 'Delete Profile', 'Delete "' + profile.profile_name + '"?', 'Delete');
            if (!confirmed) return;
            try { const response = await axios.post('/delete_profile', { id: profile.id }); if (response.data.status === 'success') { this.showToast('success', 'Profile deleted'); this.selectedProfiles = this.selectedProfiles.filter(p => p.id !== profile.id); this.loadProfiles(); } else { this.showToast('error', response.data.message || 'Failed to delete profile'); } } catch (error) { this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to delete profile'); }
        },
        resetProfileForm() { this.profileForm = { id: null, profile_name: '', profile_path: '', location: '' }; },
        updateProfileLocation(profile) { axios.post('/update_profile_location', { id: profile.id, location: profile.location }).then(response => { if (response.data.status === 'success') { this.showToast('success', 'Location updated!'); } else { this.showToast('error', response.data.message || 'Failed to update location'); } }).catch(error => { this.showToast('error', 'Failed to update location'); }); },
        toggleProfileActive(profile) { const newStatus = !profile.is_active; axios.post('/toggle_profile_active', { id: profile.id, is_active: newStatus }).then(response => { if (response.data.status === 'success') { profile.is_active = newStatus; this.showToast('success', 'Profile ' + (newStatus ? 'activated' : 'deactivated')); if (!newStatus) { this.selectedProfiles = this.selectedProfiles.filter(p => p.id !== profile.id); } } else { this.showToast('error', response.data.message || 'Failed to update status'); } }).catch(error => { this.showToast('error', 'Failed to update profile status'); }); },
        validatePath() { if (!this.profileForm.profile_path) { this.showToast('warning', 'Please enter a path first'); return; } axios.post('/validate_profile_path', { path: this.profileForm.profile_path }).then(response => { if (response.data.status === 'success') { if (response.data.exists && response.data.is_directory) { this.showDialog('success', 'Valid Path', 'The profile path exists and is valid!'); } else if (response.data.exists) { this.showDialog('warning', 'Not a Directory', 'The path exists but is not a directory.'); } else { this.showDialog('warning', 'Path Not Found', 'The profile path does not exist.'); } } }).catch(error => { this.showToast('error', 'Failed to validate path'); }); },
        isProfileSelected(profile) { return this.selectedProfiles.some(p => p.id === profile.id); },
        // Profile checkbox - NO LIMIT on profiles anymore
        onProfileCheckboxChange(event, profile) { 
            const isChecked = event.target.checked; 
            if (!profile.is_active) { 
                event.preventDefault(); 
                event.target.checked = false; 
                this.showToast('warning', 'Cannot select an inactive profile'); 
                return false; 
            } 
            if (isChecked) { 
                this.selectedProfiles.push(profile); 
            } else { 
                this.selectedProfiles = this.selectedProfiles.filter(p => p.id !== profile.id); 
            } 
        },
        // Listing checkbox - NOW HAS LIMIT
        onListingCheckboxChange(event, listingId) {
            const isChecked = event.target.checked;
            if (isChecked) {
                if (this.selectedListings.length >= this.maxListingSelection) {
                    event.preventDefault();
                    event.target.checked = false;
                    this.showDialog('warning', 'Selection Limit', 'You can only select up to ' + this.maxListingSelection + ' listings at a time.');
                    return false;
                }
                if (!this.selectedListings.includes(listingId)) {
                    this.selectedListings.push(listingId);
                }
            } else {
                this.selectedListings = this.selectedListings.filter(id => id !== listingId);
            }
        },
        showDialog(type, title, message, confirmText = 'OK') { return new Promise((resolve) => { this.dialog = { show: true, type: type, title: title, message: message, confirmText: confirmText, onConfirm: () => { this.dialog.show = false; resolve(true); }, onCancel: () => { this.dialog.show = false; resolve(false); } }; }); },
        handleDialogConfirm() { if (this.dialog.onConfirm) this.dialog.onConfirm(); },
        handleDialogCancel() { if (this.dialog.onCancel) this.dialog.onCancel(); },
        getDialogIcon(type) { const icons = {'success': 'fas fa-check-circle','error': 'fas fa-times-circle','warning': 'fas fa-exclamation-triangle','info': 'fas fa-info-circle','confirm': 'fas fa-question-circle'}; return icons[type] || icons['info']; },
        showToast(type, message, duration = 3000) { this.toast = { show: true, type: type, message: message }; setTimeout(() => { this.toast.show = false; }, duration); },
        getToastIcon(type) { const icons = {'success': 'fas fa-check-circle','error': 'fas fa-times-circle','warning': 'fas fa-exclamation-triangle','info': 'fas fa-info-circle'}; return icons[type] || icons['info']; },
        getToastColor(type) { const colors = {'success': 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)','error': 'linear-gradient(135deg, #f56565 0%, #e53e3e 100%)','warning': 'linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)','info': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)','confirm': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'}; return colors[type] || colors['info']; },
        resetForm() { this.newListing = { Year: '', Make: '', Model: '', Mileage: '', Price: '', 'Body Style': '', 'Exterior Color': '', 'Interior Color': '', 'Vehicle Condition': '', 'Fuel Type': '', Transmission: '', Description: '', 'Images Path': '', 'selectedDay': '', image_ids: [], image_folder: '' }; this.showToast('info', 'Form reset'); },
        addListing() { axios.post('/add_listing', this.newListing).then(response => { if (response.data.status === 'success') { this.resetForm(); this.showDialog('success', 'Success!', 'Listing added!'); this.loadListings(); } else { this.showDialog('error', 'Error', response.data.message || 'Failed to add listing.'); } }).catch(error => { this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to add listing.'); }); },
        editListing(listingId) { const listing = this.listings.find(l => l.id === listingId); if (!listing) { this.showToast('error', 'Listing not found'); return; } this.editingListing = listingId; this.editForm = JSON.parse(JSON.stringify(listing)); },
        cancelEdit() { this.editingListing = null; this.editForm = {}; },
        updateListing() { if (!this.editForm.id) { this.showToast('error', 'No listing ID found'); return; } axios.post('/update_listing', this.editForm).then(response => { if (response.data.status === 'success') { this.cancelEdit(); this.showDialog('success', 'Updated!', 'Listing updated!'); this.loadListings(); } else { this.showDialog('error', 'Error', response.data.message || 'Failed to update listing.'); } }).catch(error => { this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to update listing.'); }); },
        async confirmDelete(listingId) { if (!listingId && listingId !== 0) { this.showToast('error', 'Invalid listing ID'); return; } const confirmed = await this.showDialog('confirm', 'Confirm Delete', 'Delete this listing?', 'Delete'); if (!confirmed) return; try { const response = await axios.post('/delete_listing', { index: listingId }); if (response.data.status === 'success') { this.showToast('success', 'Listing moved to deleted listings'); this.listings = this.listings.filter(l => l.id !== listingId); this.selectedListings = this.selectedListings.filter(id => id !== listingId); if (this.activeTab === 'deleted') { this.loadDeletedListings(); } } else { this.showToast('error', response.data.message || 'Failed to delete listing'); } } catch (error) { this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to delete listing'); } },
        // Toggle all listings - respects the limit
        toggleAllListings(event) { 
            if (event.target.checked) { 
                // Only select up to the max allowed
                const idsToSelect = this.listings.map(listing => listing.id).slice(0, this.maxListingSelection);
                this.selectedListings = idsToSelect;
                if (this.listings.length > this.maxListingSelection) {
                    this.showToast('warning', 'Only first ' + this.maxListingSelection + ' listings selected (limit reached)');
                }
            } else { 
                this.selectedListings = []; 
            } 
        },
        loadListings() { axios.get('/get_listings').then(response => { if (response.data.status === 'success') { this.listings = response.data.listings; } else { this.showToast('error', 'Failed to load listings'); } }).catch(error => { this.showToast('error', 'Failed to load listings'); }); },
