// ========================================================================
        // MEDIA PICKER & UPLOAD METHODS
        // ========================================================================
        openMediaPicker(mode) {
            this.pickerMode = mode;
            this.showMediaPicker = true;
            this.pickerSelected = null;
            if (this.driveFiles.length === 0) {
                this.loadDriveFiles();
            }
        },
        closeMediaPicker() {
            this.showMediaPicker = false;
            this.pickerSelected = null;
            this.mediaSearch = '';
        },
        selectMediaForPicker(file) {
            this.pickerSelected = file;
        },
        confirmMediaSelection() {
            if (!this.pickerSelected) return;
            
            const filePath = this.pickerSelected.webViewLink || `https://drive.google.com/uc?id=${this.pickerSelected.id}`;
            
            if (this.pickerMode === 'new') {
                this.newListing['Images Path'] = filePath;
            } else if (this.pickerMode === 'edit') {
                this.editForm['Images Path'] = filePath;
            }
            
            this.closeMediaPicker();
            this.showToast('success', 'Media file selected!');
        },
        searchDriveFiles() {
            if (!this.mediaSearch.trim()) {
                this.loadDriveFiles();
                return;
            }
            this.loadingMedia = true;
            axios.get('/search_drive_files', { params: { q: this.mediaSearch } })
            .then(response => {
                if (response.data.status === 'success') {
                    this.driveFiles = response.data.files;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                this.showToast('error', 'Search failed');
            })
            .finally(() => {
                this.loadingMedia = false;
            });
        },
        clearMediaSearch() {
            this.mediaSearch = '';
            this.loadDriveFiles();
        },
        openFileUpload(mode) {
            this.currentFolder = '';
            this.pickerMode = mode;
            this.showUploadModal = true;
            this.selectedFiles = [];
            this.uploadProgress = 0;
        },
        closeUploadModal() {
            if (!this.uploading) {
                this.showUploadModal = false;
                this.selectedFiles = [];
                this.uploadProgress = 0;
                this.currentFolder = '';
            }
        },
        handleFileSelect(event) {
            const files = Array.from(event.target.files);
            this.selectedFiles = [...this.selectedFiles, ...files];
        },
        handleFileDrop(event) {
            this.dragOver = false;
            const files = Array.from(event.dataTransfer.files);
            this.selectedFiles = [...this.selectedFiles, ...files];
        },
        removeFile(index) {
            this.selectedFiles.splice(index, 1);
        },
        uploadFiles() {
            if (this.selectedFiles.length === 0) {
                this.showToast('warning', 'No files selected');
                return;
            }
            
            this.uploading = true;
            this.uploadProgress = 0;
            
            const totalFiles = this.selectedFiles.length;
            let uploadedCount = 0;
            let lastUploadedFile = null;
            
            const uploadNext = (index) => {
                if (index >= this.selectedFiles.length) {
                    this.uploading = false;
                    this.uploadProgress = 100;
                    
                    this.showDialog('success', 'Upload Complete', `Successfully uploaded ${uploadedCount} of ${totalFiles} file(s)!`);
                    
                    if (lastUploadedFile && (this.pickerMode === 'new' || this.pickerMode === 'edit' || this.pickerMode === 'picker')) {
                        const filePath = lastUploadedFile.webViewLink || `https://drive.google.com/uc?id=${lastUploadedFile.id}`;
                        
                        if (this.pickerMode === 'new') {
                            this.newListing['Images Path'] = filePath;
                            this.showToast('success', 'Path set to uploaded file!');
                        } else if (this.pickerMode === 'edit') {
                            this.editForm['Images Path'] = filePath;
                            this.showToast('success', 'Path set to uploaded file!');
                        } else if (this.pickerMode === 'picker') {
                            this.pickerSelected = lastUploadedFile;
                            this.confirmMediaSelection();
                        }
                    }
                    
                    this.closeUploadModal();
                    if (this.activeTab === 'media') {
                        this.loadDriveStructure();
                    } else {
                        this.loadDriveFiles();
                    }
                    return;
                }
                
                const file = this.selectedFiles[index];
                const formData = new FormData();
                formData.append('file', file);
                
                if (this.currentFolder) {
                    formData.append('folder_name', this.currentFolder);
                    console.log(`Uploading file ${index + 1}/${totalFiles} to folder "${this.currentFolder}": ${file.name}`);
                } else {
                    console.log(`Uploading file ${index + 1}/${totalFiles}: ${file.name}`);
                }
                
                axios.post('/upload_to_drive', formData, {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    },
                    timeout: 120000
                })
                .then(response => {
                    console.log('Upload response:', response.data);
                    if (response.data.status === 'success') {
                        uploadedCount++;
                        lastUploadedFile = response.data.file;
                        this.uploadProgress = Math.round(((index + 1) / totalFiles) * 100);
                        this.showToast('success', `Uploaded: ${file.name}`);
                        uploadNext(index + 1);
                    } else {
                        console.error('Upload failed:', response.data);
                        this.showToast('error', `Failed: ${file.name} - ${response.data.message}`);
                        uploadNext(index + 1);
                    }
                })
                .catch(error => {
                    console.error('Upload error:', error);
                    const errorMsg = error.response?.data?.message || error.message || 'Unknown error';
                    this.showToast('error', `Failed: ${file.name} - ${errorMsg}`);
                    uploadNext(index + 1);
                });
            };
            
            uploadNext(0);
        },

        // ========================================================================
        // SCHEDULE METHODS - FIXED FOR EDGE PROFILES
        // ========================================================================
        loadScheduledPosts() {
            this.loadingSchedule = true;
            axios.get('/get_scheduled_posts')
                .then(response => {
                    if (response.data.status === 'success') {
                        this.scheduledPosts = response.data.scheduled_posts;
                        console.log(`âœ… Loaded ${this.scheduledPosts.length} scheduled posts`);
                    } else {
                        this.showToast('error', 'Failed to load scheduled posts');
                    }
                    this.loadScheduleStats();
                })
                .catch(error => {
                    console.error('Error loading scheduled posts:', error);
                    this.showToast('error', 'Failed to load scheduled posts');
                })
                .finally(() => {
                    this.loadingSchedule = false;
                });
        },
        loadScheduleStats() {
            axios.get('/get_schedule_stats')
                .then(response => {
                    if (response.data.status === 'success') {
                        this.scheduleStats = response.data.stats;
                    }
                })
                .catch(error => {
                    console.error('Error loading schedule stats:', error);
                });
        },
        
        // FIXED: Use correct Edge profile property names
        onScheduleProfileChange() {
            console.log('Schedule profile changed:', this.scheduleForm.profile_id);
            
            // Find the selected profile by ID (not folder_name)
            this.selectedScheduleProfile = this.profiles.find(
                p => p.id === this.scheduleForm.profile_id
            );
            
            if (this.selectedScheduleProfile) {
                // Use profile_name instead of user_name
                this.scheduleForm.profile_name = this.selectedScheduleProfile.profile_name;
                this.scheduleForm.profile_path = this.selectedScheduleProfile.profile_path;
                this.scheduleForm.location = this.selectedScheduleProfile.location || '';
                
                console.log('Selected profile:', this.selectedScheduleProfile.profile_name);
            } else {
                this.scheduleForm.profile_name = '';
                this.scheduleForm.profile_path = '';
                this.scheduleForm.location = '';
            }
        },
        
        // FIXED: Use correct property names when scheduling
        scheduleNewPost() {
            // Validate required fields
            if (!this.scheduleForm.listing_id) {
                this.showToast('warning', 'Please select a listing');
                return;
            }
            
            if (!this.scheduleForm.profile_id) {
                this.showToast('warning', 'Please select an Edge profile');
                return;
            }
            
            if (!this.scheduleForm.datetime) {
                this.showToast('warning', 'Please select a date and time');
                return;
            }
            
            // Check if selected profile is active
            if (this.selectedScheduleProfile && !this.selectedScheduleProfile.is_active) {
                this.showToast('error', 'Cannot schedule with an inactive profile');
                return;
            }
            
            // Prepare schedule data with correct property names
            const scheduleData = {
                listing_id: this.scheduleForm.listing_id,
                profile_id: this.scheduleForm.profile_id,
                profile_name: this.scheduleForm.profile_name,
                profile_path: this.scheduleForm.profile_path,
                location: this.scheduleForm.location,
                scheduled_datetime: new Date(this.scheduleForm.datetime).toISOString(),
                recurrence: this.scheduleForm.recurrence || 'none'
            };
            
            console.log('Scheduling post:', scheduleData);
            
            axios.post('/schedule_post', scheduleData)
                .then(response => {
                    if (response.data.status === 'success') {
                        this.showDialog('success', 'Success!', 'Post scheduled successfully');
                        this.loadScheduledPosts();
                        
                        // Reset form
                        this.scheduleForm = {
                            listing_id: '',
                            profile_id: '',
                            profile_name: '',
                            profile_path: '',
                            location: '',
                            datetime: '',
                            recurrence: 'none'
                        };
                        this.selectedScheduleProfile = null;
                    } else {
                        this.showDialog('error', 'Error', response.data.message || 'Failed to schedule post');
                    }
                })
                .catch(error => {
                    console.error('Error scheduling post:', error);
                    this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to schedule post');
                });
        },
        
        async cancelScheduledPost(scheduleId) {
            const confirmed = await this.showDialog('confirm', 'Cancel Schedule', 
                'Are you sure you want to cancel this scheduled post?', 'Cancel Post');
            if (!confirmed) return;
            
            axios.post('/update_scheduled_post', {
                schedule_id: scheduleId,
                status: 'cancelled'
            })
            .then(response => {
                if (response.data.status === 'success') {
                    this.showToast('success', 'Scheduled post cancelled');
                    this.loadScheduledPosts();
                } else {
                    this.showToast('error', response.data.message || 'Failed to cancel');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                this.showToast('error', 'Failed to cancel scheduled post');
            });
        },
        
        async deleteScheduledPost(scheduleId) {
            const confirmed = await this.showDialog('confirm', 'Delete Schedule', 
                'Are you sure you want to delete this scheduled post?', 'Delete');
            if (!confirmed) return;
            
            axios.post('/delete_scheduled_post', {
                schedule_id: scheduleId
            })
            .then(response => {
                if (response.data.status === 'success') {
                    this.showToast('success', 'Scheduled post deleted');
                    this.loadScheduledPosts();
                } else {
                    this.showToast('error', response.data.message || 'Failed to delete');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                this.showToast('error', 'Failed to delete scheduled post');
            });
        },