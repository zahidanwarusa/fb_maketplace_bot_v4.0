<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Marketplace Automation</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app" class="container mx-auto p-4">
        <nav class="bg-white shadow-lg rounded-lg p-4 mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Facebook Marketplace Automation</h1>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Profile Management Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-user-circle mr-2"></i>Chrome Profiles
                </h2>
                <div class="space-y-4">
                    <div v-for="profile in profiles" :key="profile.folder_name" class="flex items-center space-x-4">
                        <input 
                            type="checkbox" 
                            v-model="selectedProfiles" 
                            :value="profile"
                            class="form-checkbox h-5 w-5 text-blue-600">
                        <span class="text-gray-700 font-medium">
                            [[ profile.user_name ]] ([[ profile.folder_name ]])
                        </span>
                        <input 
                            type="text" 
                            v-model="profileLocations[profile.folder_name]" 
                            placeholder="Enter location"
                            @change="updateProfileLocation(profile.folder_name)"
                            class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>

            <!-- Add Listing Form -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-plus-circle mr-2"></i>Add New Listing
                </h2>
                <form @submit.prevent="addListing" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Year</label>
                            <input v-model="newListing.Year" type="number" class="mt-1 w-full p-2 border rounded" required>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700">Make</label>
                            <select v-model="newListing.Make" class="mt-1 w-full p-2 border rounded bg-white text-gray-900" required>
                              <option value="">Select Make</option>
                              <option value="Acura">Acura</option>
                              <option value="Alfa Romeo">Alfa Romeo</option>
                              <option value="Aston Martin">Aston Martin</option>
                              <option value="Audi">Audi</option>
                              <option value="BMW">BMW</option>
                              <option value="Bentley">Bentley</option>
                              <option value="Buick">Buick</option>
                              <option value="CODA">CODA</option>
                              <option value="Cadillac">Cadillac</option>
                              <option value="Chevrolet">Chevrolet</option>
                              <option value="Chrysler">Chrysler</option>
                              <option value="Dodge">Dodge</option>
                              <option value="Ferrari">Ferrari</option>
                              <option value="Fiat">Fiat</option>
                              <option value="Ford">Ford</option>
                              <option value="GMC">GMC</option>
                              <option value="Genesis">Genesis</option>
                              <option value="Honda">Honda</option>
                              <option value="Hyundai">Hyundai</option>
                              <option value="Infiniti">Infiniti</option>
                              <option value="Jaguar">Jaguar</option>
                              <option value="Jeep">Jeep</option>
                              <option value="Kia">Kia</option>
                              <option value="Lamborghini">Lamborghini</option>
                              <option value="Land Rover">Land Rover</option>
                              <option value="Lexus">Lexus</option>
                              <option value="Lincoln">Lincoln</option>
                              <option value="Maserati">Maserati</option>
                              <option value="Mazda">Mazda</option>
                              <option value="Mercedes-Benz">Mercedes-Benz</option>
                              <option value="Mini">Mini</option>
                              <option value="Mitsubishi">Mitsubishi</option>
                              <option value="Nissan">Nissan</option>
                              <option value="Porsche">Porsche</option>
                              <option value="Ram">Ram</option>
                              <option value="Subaru">Subaru</option>
                              <option value="Tesla">Tesla</option>
                              <option value="Toyota">Toyota</option>
                              <option value="Volkswagen">Volkswagen</option>
                              <option value="Volvo">Volvo</option>
                            </select>
                          </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Model</label>
                            <input v-model="newListing.Model" type="text" class="mt-1 w-full p-2 border rounded" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Mileage</label>
                            <input v-model="newListing.Mileage" type="number" class="mt-1 w-full p-2 border rounded" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Price</label>
                            <input v-model="newListing.Price" type="number" class="mt-1 w-full p-2 border rounded" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Body Style</label>
                            <select v-model="newListing['Body Style']" class="mt-1 w-full p-2 border rounded" required>
                                <option value="">Select Body Style</option>
                                <option value="Sedan">Sedan</option>
                                <option value="SUV">SUV</option>
                                <option value="Coupe">Coupe</option>
                                <option value="Truck">Truck</option>
                                <option value="Hatchback">Hatchback</option>
                                <option value="Convertible">Convertible</option>
                                <option value="Wagon">Wagon</option>
                                <option value="Minivan">Minivan</option>
                                <option value="Small Car">Small Car</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700">Exterior Color</label>
                          <select v-model="newListing['Exterior Color']" class="mt-1 w-full p-2 border rounded bg-white text-gray-900" required>
                            <option value="">Select Exterior Color</option>
                            <option value="Black">Black</option>
                            <option value="Blue">Blue</option>
                            <option value="Brown">Brown</option>
                            <option value="Gold">Gold</option>
                            <option value="Green">Green</option>
                            <option value="Gray">Gray</option>
                            <option value="Pink">Pink</option>
                            <option value="Purple">Purple</option>
                            <option value="Red">Red</option>
                            <option value="Silver">Silver</option>
                            <option value="Orange">Orange</option>
                            <option value="White">White</option>
                            <option value="Yellow">Yellow</option>
                            <option value="Charcoal">Charcoal</option>
                            <option value="Off white">Off white</option>
                            <option value="Tan">Tan</option>
                            <option value="Beige">Beige</option>
                            <option value="Burgundy">Burgundy</option>
                            <option value="Turquoise">Turquoise</option>
                          </select>
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700">Interior Color</label>
                          <select v-model="newListing['Interior Color']" class="mt-1 w-full p-2 border rounded bg-white text-gray-900" required>
                            <option value="">Select Interior Color</option>
                            <option value="Black">Black</option>
                            <option value="Blue">Blue</option>
                            <option value="Brown">Brown</option>
                            <option value="Gold">Gold</option>
                            <option value="Green">Green</option>
                            <option value="Gray">Gray</option>
                            <option value="Pink">Pink</option>
                            <option value="Purple">Purple</option>
                            <option value="Red">Red</option>
                            <option value="Silver">Silver</option>
                            <option value="Orange">Orange</option>
                            <option value="White">White</option>
                            <option value="Yellow">Yellow</option>
                            <option value="Charcoal">Charcoal</option>
                            <option value="Off white">Off white</option>
                            <option value="Tan">Tan</option>
                            <option value="Beige">Beige</option>
                            <option value="Burgundy">Burgundy</option>
                            <option value="Turquoise">Turquoise</option>
                          </select>
                        </div>
                      </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Vehicle Condition</label>
                            <select v-model="newListing['Vehicle Condition']" class="mt-1 w-full p-2 border rounded" required>
                                <option value="">Select Condition</option>
                                <option value="Excellent">Excellent</option>
                                <option value="Very good">Very good</option>
                                <option value="Good">Good</option>
                                <option value="Fair">Fair</option>
                                <option value="Poor">Poor</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fuel Type</label>
                            <select v-model="newListing['Fuel Type']" class="mt-1 w-full p-2 border rounded" required>
                                <option value="">Select Fuel Type</option>
                                <option value="Diesel">Diesel</option>
                                <option value="Electric">Electric</option>
                                <option value="Gasoline">Gasoline</option>
                                <option value="Flex">Flex</option>
                                <option value="Hybrid">Hybrid</option>
                                <option value="Petrol">Petrol</option>
                                <option value="Plug-in hybrid">Plug-in hybrid</option>
                                <option value="Other">Other</option>
                            </select>
                                                        
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Transmission</label>
                            <select v-model="newListing.Transmission" class="mt-1 w-full p-2 border rounded" required>
                                <option value="">Select Transmission</option>
                                <option value="Manual transmission">Manual transmission</option>
                                <option value="Automatic transmission">Automatic transmission</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Images Path</label>
                            <input v-model="newListing['Images Path']" type="text" class="mt-1 w-full p-2 border rounded" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea v-model="newListing.Description" class="mt-1 w-full p-2 border rounded" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition-colors">
                        Add Listing
                    </button>
                </form>
            </div>
        </div>

        <!-- Existing Listings Section -->
        <div class="mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-list mr-2"></i>Existing Listings
            </h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Select</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vehicle</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr v-for="(listing, index) in listings" :key="index">
                            <td class="px-6 py-4">
                                <input type="checkbox" v-model="selectedListings" :value="index" class="form-checkbox h-5 w-5 text-blue-600">
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-medium text-gray-900">
                                    [[ listing.Year ]] [[ listing.Make ]] [[ listing.Model ]]
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-500">
                                    [[ listing['Body Style'] ]] • [[ listing['Exterior Color'] ]] • [[ listing.Mileage ]] miles
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-medium text-gray-900">
                                    $[[ listing.Price.toLocaleString() ]]
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <button @click="deleteListing(index)" class="text-red-600 hover:text-red-900">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 flex justify-end space-x-4">
            <button 
                @click="runBot" 
                :disabled="isRunning || !hasSelections" 
                class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center">
                <i class="fas fa-play mr-2"></i>
                [[ isRunning ? 'Running...' : 'Run Bot' ]]
            </button>
        </div>

        <!-- Logs Section -->
        <div v-if="logs" class="mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-terminal mr-2"></i>Execution Logs
            </h2>
            <div class="bg-gray-900 text-green-400 p-4 rounded-lg">
                <pre class="whitespace-pre-wrap font-mono text-sm">[[ logs ]]</pre>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            data: {
                profiles: {{ profiles | tojson | safe }},
                listings: {{ listings | tojson | safe }},
                profileLocations: {{ profile_locations | tojson | safe }},
                selectedProfiles: [],
                selectedListings: [],
                logs: '',
                isRunning: false,
                newListing: {
                    Year: '',
                    Make: '',
                    Model: '',
                    Mileage: '',
                    Price: '',
                    'Body Style': '',
                    'Exterior Color': '',
                    'Interior Color': '',
                    'Vehicle Condition': '',
                    'Fuel Type': '',
                    Transmission: '',
                    Description: '',
                    'Images Path': ''
                },
                colorOptions: [
                    'Black', 'Blue', 'Brown', 'Gold', 'Green', 'Gray', 'Pink', 'Purple', 
                    'Red', 'Silver', 'Orange', 'White', 'Yellow', 'Charcoal', 'Off white', 
                    'Tan', 'Beige', 'Burgundy', 'Turquoise'
                ],
                makeOptions: [
                    'Acura', 'Alfa Romeo', 'Aston Martin', 'Audi', 'BMW', 'Bentley', 'Buick', 
                    'CODA', 'Cadillac', 'Chevrolet', 'Chrysler', 'Daewoo', 'Daihatsu', 'Dodge', 
                    'Eagle', 'Ferrari', 'Fiat', 'Fisker', 'Ford', 'Freightliner', 'GMC', 'Genesis', 
                    'Geo', 'Honda', 'Hummer', 'Hyundai', 'Infiniti', 'Isuzu', 'Jaguar', 'Jeep', 
                    'Kia', 'Lamborghini', 'Land Rover', 'Lexus', 'Lincoln', 'Lotus', 'Lucid', 
                    'MINI', 'Maserati', 'Maybach', 'Mazda', 'Mclaren', 'Mercedes-Benz', 'Mercury', 
                    'Mitsubishi', 'Nissan', 'Oldsmobile', 'Panoz', 'Plymouth', 'Polestar', 'Pontiac', 
                    'Porsche', 'Ram', 'Rivian', 'Rolls-Royce', 'SRT', 'Saab', 'Saturn', 'Scion', 
                    'Smart', 'Subaru', 'Suzuki', 'Tesla', 'Toyota', 'Volkswagen', 'Volvo'
                ],
            },
            computed: {
                hasSelections() {
                    return this.selectedProfiles.length > 0 && this.selectedListings.length > 0;
                }
            },
            methods: {
                updateProfileLocation(folderName) {
                    axios.post('/update_profile_location', {
                        profile: folderName,
                        location: this.profileLocations[folderName]
                    })
                    .catch(error => {
                        console.error('Error updating profile location:', error);
                    });
                },
                addListing() {
                    axios.post('/add_listing', this.newListing)
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.listings.push({...this.newListing});
                                // Reset form
                                this.newListing = {
                                    Year: '',
                                    Make: '',
                                    Model: '',
                                    Mileage: '',
                                    Price: '',
                                    'Body Style': '',
                                    'Exterior Color': '',
                                    'Interior Color': '',
                                    'Vehicle Condition': '',
                                    'Fuel Type': '',
                                    Transmission: '',
                                    Description: '',
                                    'Images Path': ''
                                };
                                // Show success message
                                alert('Listing added successfully!');
                            }
                        })
                        .catch(error => {
                            console.error('Error adding listing:', error);
                            alert('Error adding listing. Please try again.');
                        });
                },
                deleteListing(index) {
                    if (confirm('Are you sure you want to delete this listing?')) {
                        axios.post('/delete_listing', { index: index })
                            .then(response => {
                                if (response.data.status === 'success') {
                                    this.listings.splice(index, 1);
                                    // Remove from selected listings if it was selected
                                    this.selectedListings = this.selectedListings.filter(i => i !== index);
                                }
                            })
                            .catch(error => {
                                console.error('Error deleting listing:', error);
                                alert('Error deleting listing. Please try again.');
                            });
                    }
                },
                runBot() {
                    if (!this.hasSelections) {
                        alert('Please select at least one profile and one listing.');
                        return;
                    }
                    
                    // Check if all selected profiles have locations
                    const missingLocations = this.selectedProfiles.filter(p => !this.profileLocations[p.folder_name]);
                    if (missingLocations.length > 0) {
                        alert(`Please set locations for the following profiles:\n${missingLocations.map(p => p.user_name).join('\n')}`);
                        return;
                    }

                    this.isRunning = true;
                    this.logs = 'Initializing bot...\n';
                    axios.post('/run_bot', {
                        profiles: this.selectedProfiles,
                        listings: this.selectedListings
                    })
                    .then(response => {
                        this.logs += response.data.stdout;
                        if (response.data.stderr) {
                            this.logs += '\nErrors:\n' + response.data.stderr;
                        }
                    })
                    .catch(error => {
                        this.logs += 'Error: ' + error;
                    })
                    .finally(() => {
                        this.isRunning = false;
                    });
                }
            }
        });
        </script>
</body>
</html>