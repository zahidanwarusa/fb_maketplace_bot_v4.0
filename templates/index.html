<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FB Marketplace Automation - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/brands.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Dashboard Container */
        .dashboard-container {
            background: #f8f9fa;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            height: 100vh;
            position: fixed;
            width: 260px;
            z-index: 100;
        }

        .sidebar-logo {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu {
            padding: 16px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
        }

        .menu-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 24px;
        }

        /* Top Bar */
        .top-bar {
            background: white;
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            font-size: 24px;
        }

        .stat-icon.blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .stat-icon.green { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; }
        .stat-icon.orange { background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); color: white; }
        .stat-icon.purple { background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%); color: white; }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f1f3f5;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(72, 187, 120, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Badge */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success { background: #c6f6d5; color: #22543d; }
        .badge-error { background: #fed7d7; color: #742a2a; }
        .badge-warning { background: #feebc8; color: #744210; }
        .badge-info { background: #bee3f8; color: #2c5282; }
        .badge-purple { background: #e9d8fd; color: #44337a; }

        /* Form Elements */
        input, select, textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Checkbox */
        .custom-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e0;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .custom-checkbox:checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }

        .custom-checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            color: white;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f7fafc;
        }

        th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 14px 16px;
            border-top: 1px solid #e2e8f0;
        }

        tbody tr:hover {
            background: #f7fafc;
        }

        /* Profile Card */
        .profile-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
        }

        .profile-card:hover {
            border-color: #667eea;
            background: white;
        }

        .profile-card.selected {
            border-color: #667eea;
            background: #eef2ff;
        }

        /* Modal */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            padding: 16px 20px;
            min-width: 320px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Spinner */
        .spinner {
            border: 3px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Indicator */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-dot.active { background: #48bb78; animation: pulse 2s ease-in-out infinite; }
        .status-dot.inactive { background: #cbd5e0; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* File Grid */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
        }

        .file-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .file-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .file-card.selected {
            border-color: #667eea;
            background: #eef2ff;
        }

        /* Upload Drop Zone */
        .upload-zone {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-zone:hover, .upload-zone.drag-over {
            border-color: #667eea;
            background: #eef2ff;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f3f5;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Labels */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div id="app" class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" :class="{'mobile-open': mobileMenuOpen}">
            <div class="sidebar-logo">
                <div style="display: flex; align-items: center; color: white;">
                    <i class="fas fa-car" style="font-size: 28px; margin-right: 12px;"></i>
                    <div>
                        <div style="font-size: 18px; font-weight: 700;">FB Marketplace</div>
                        <div style="font-size: 12px; opacity: 0.7;">Automation</div>
                    </div>
                </div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item" :class="{'active': activeTab === 'dashboard'}" @click="activeTab = 'dashboard'">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'profiles'}" @click="activeTab = 'profiles'">
                    <i class="fas fa-user-circle"></i>
                    <span>Profiles</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'listings'}" @click="activeTab = 'listings'">
                    <i class="fas fa-list"></i>
                    <span>Listings</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'add-listing'}" @click="activeTab = 'add-listing'">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Listing</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'media'}" @click="activeTab = 'media'; loadDriveStructure()">
                    <i class="fas fa-images"></i>
                    <span>Media Library</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'history'}" @click="activeTab = 'history'; loadUploadHistory()">
                    <i class="fas fa-history"></i>
                    <span>Upload History</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'deleted'}" @click="activeTab = 'deleted'; loadDeletedListings()">
                    <i class="fas fa-trash-restore"></i>
                    <span>Deleted Listings</span>
                </div>
                <div class="menu-item" :class="{'active': activeTab === 'schedule'}" @click="activeTab = 'schedule'; loadScheduledPosts()">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Schedule</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div>
                    <h1 style="font-size: 24px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">
                        [[ getPageTitle() ]]
                    </h1>
                    <p style="color: #718096; font-size: 14px;">[[ getPageSubtitle() ]]</p>
                </div>
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #f0fdf4; border-radius: 8px;">
                        <span class="status-dot active"></span>
                        <span style="font-weight: 600; color: #166534; font-size: 14px;">System Online</span>
                    </div>
                    <button class="btn btn-primary" @click="runBot" :disabled="isRunning || !hasSelections">
                        <i :class="isRunning ? 'fas fa-spinner fa-spin' : 'fas fa-rocket'"></i>
                        [[ isRunning ? 'Running...' : 'Launch Bot' ]]
                    </button>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div v-if="activeTab === 'dashboard'">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-list"></i>
                        </div>
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Total Listings</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a202c;">[[ listings.length ]]</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Selected Listings</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a202c;">[[ selectedListings.length ]]</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-users"></i>
                        </div>
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Active Profiles</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a202c;">[[ selectedProfiles.length ]] / [[ maxProfileSelection ]]</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Ready to Post</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a202c;">[[ hasSelections ? selectedListings.length : 0 ]]</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Quick Start</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                        <div @click="activeTab = 'profiles'" style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-user-circle" style="font-size: 32px; color: white; margin-bottom: 12px;"></i>
                            <div style="color: white; font-weight: 600; margin-bottom: 4px;">Select Profiles</div>
                            <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Choose profiles to post with</div>
                        </div>
                        <div @click="activeTab = 'listings'" style="padding: 20px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); border-radius: 12px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-list" style="font-size: 32px; color: white; margin-bottom: 12px;"></i>
                            <div style="color: white; font-weight: 600; margin-bottom: 4px;">Select Listings</div>
                            <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Choose vehicles to post</div>
                        </div>
                        <div @click="activeTab = 'add-listing'" style="padding: 20px; background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); border-radius: 12px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-plus-circle" style="font-size: 32px; color: white; margin-bottom: 12px;"></i>
                            <div style="color: white; font-weight: 600; margin-bottom: 4px;">Add New Listing</div>
                            <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Create a new vehicle listing</div>
                        </div>
                        <div @click="runBot" :style="{opacity: hasSelections ? 1 : 0.5, cursor: hasSelections ? 'pointer' : 'not-allowed'}" style="padding: 20px; background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%); border-radius: 12px; transition: transform 0.2s;" onmouseover="if(this.style.opacity==='1')this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-rocket" style="font-size: 32px; color: white; margin-bottom: 12px;"></i>
                            <div style="color: white; font-weight: 600; margin-bottom: 4px;">Launch Bot</div>
                            <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Start posting to marketplace</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card" v-if="uploadHistory.length > 0">
                    <div class="card-header">
                        <div class="card-title">Recent Activity</div>
                        <button class="btn btn-secondary" @click="activeTab = 'history'">View All</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Profile</th>
                                    <th>Vehicle</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="upload in uploadHistory.slice(0, 5)" :key="upload.id">
                                    <td>[[ formatDate(upload.upload_datetime) ]]</td>
                                    <td>[[ upload.profile_name ]]</td>
                                    <td>[[ upload.vehicle_info.year ]] [[ upload.vehicle_info.make ]] [[ upload.vehicle_info.model ]]</td>
                                    <td><span :class="'badge badge-' + getStatusType(upload.status)">[[ upload.status ]]</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Profiles Tab -->
            <div v-if="activeTab === 'profiles'">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Chrome Profiles</div>
                        <div style="display: flex; gap: 12px;">
                            <span class="badge badge-info">[[ profiles.length ]] Total</span>
                            <span :class="selectedProfiles.length >= maxProfileSelection ? 'badge badge-error' : 'badge badge-success'">
                                [[ selectedProfiles.length ]] / [[ maxProfileSelection ]] Selected
                            </span>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 16px;">
                        <div v-for="profile in profiles" :key="profile.folder_name" 
                             class="profile-card"
                             :class="{'selected': selectedProfiles.some(p => p.folder_name === profile.folder_name)}">
                            <div style="display: flex; align-items: start; gap: 12px;">
                                <input type="checkbox" 
                                       :value="profile"
                                       :checked="selectedProfiles.some(p => p.folder_name === profile.folder_name)"
                                       @change="onProfileCheckboxChange($event, profile)"
                                       class="custom-checkbox"
                                       style="margin-top: 4px;">
                                <div style="flex: 1;">
                                    <!-- Profile Name -->
                                    <div style="font-weight: 600; color: #1a202c; margin-bottom: 4px; font-size: 16px;">
                                        [[ profile.user_name ]]
                                    </div>
                                    <div style="color: #718096; font-size: 13px; margin-bottom: 12px;">
                                        [[ profile.folder_name ]]
                                    </div>
                                    
                                    <!-- Facebook Accounts Section -->
                                    <div v-if="profile.facebook_accounts && profile.facebook_accounts.length > 0" 
                                         style="background: #f7fafc; padding: 12px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #667eea;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                                            <i class="fab fa-facebook" style="color: #1877f2; font-size: 16px;"></i>
                                            <span style="font-weight: 600; font-size: 13px; color: #4a5568;">Facebook Accounts</span>
                                        </div>
                                        <div v-for="(account, index) in profile.facebook_accounts" :key="index" 
                                             style="display: flex; align-items: center; gap: 8px; padding: 6px 0;">
                                            <input type="checkbox" 
                                                   :checked="account.selected"
                                                   @change="toggleFacebookAccount(profile.folder_name, index)"
                                                   class="custom-checkbox"
                                                   style="width: 16px; height: 16px;">
                                            <div style="flex: 1;">
                                                <div style="font-size: 13px; font-weight: 500; color: #1a202c;">
                                                    [[ account.name ]]
                                                </div>
                                                <div style="font-size: 11px; color: #718096;">
                                                    [[ account.email || 'No email available' ]]
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- No Facebook Account -->
                                    <div v-else style="background: #fef3c7; padding: 10px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #f59e0b;">
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 14px;"></i>
                                            <span style="font-size: 12px; color: #92400e; font-weight: 500;">No Facebook account logged in</span>
                                        </div>
                                    </div>
                                    
                                    
                                    <!-- Notifications Section -->
                                    <div v-if="profile.facebook_accounts && profile.facebook_accounts.length > 0" 
                                         style="background: #eff6ff; padding: 10px; border-radius: 8px; margin-bottom: 12px; border-left: 3px solid #3b82f6;">
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <i class="fas fa-bell" style="color: #3b82f6;"></i>
                                                <span style="font-size: 13px; font-weight: 600; color: #1e40af;">Notifications</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <span v-if="profileNotifications[profile.folder_name]" 
                                                      :class="profileNotifications[profile.folder_name].notification_count > 0 ? 'badge badge-error' : 'badge badge-success'"
                                                      style="font-size: 11px;">
                                                    [[ profileNotifications[profile.folder_name].notification_count || 0 ]]
                                                </span>
                                                <button @click="checkNotifications(profile.folder_name)" 
                                                        :disabled="checkingNotifications"
                                                        class="btn btn-primary" 
                                                        style="padding: 4px 12px; font-size: 12px;">
                                                    <i :class="checkingNotifications ? 'fas fa-spinner fa-spin' : 'fas fa-sync-alt'"></i>
                                                    [[ checkingNotifications ? 'Checking...' : 'Check' ]]
                                                </button>
                                            </div>
                                        </div>
                                        <div v-if="profileNotifications[profile.folder_name] && profileNotifications[profile.folder_name].last_checked" 
                                             style="font-size: 11px; color: #64748b; margin-top: 6px;">
                                            Last checked: [[ formatDateTime(profileNotifications[profile.folder_name].last_checked) ]]
                                        </div>
                                    </div>
                                                                        <!-- Location Input -->
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <i class="fas fa-map-marker-alt" style="color: #667eea;"></i>
                                        <input type="text" 
                                               v-model="profileLocations[profile.folder_name]" 
                                               placeholder="Enter location"
                                               @blur="updateProfileLocation(profile.folder_name)"
                                               style="flex: 1; font-size: 14px; padding: 8px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Listings Tab -->
            <div v-if="activeTab === 'listings'">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Vehicle Listings</div>
                        <div style="display: flex; gap: 12px;">
                            <span class="badge badge-info">[[ listings.length ]] Total</span>
                            <span class="badge badge-success">[[ selectedListings.length ]] Selected</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" 
                                               @change="toggleAllListings"
                                               :checked="allListingsSelected"
                                               class="custom-checkbox">
                                    </th>
                                    <th>Vehicle</th>
                                    <th>Details</th>
                                    <th>Price</th>
                                    
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(listing, index) in listings" :key="index">
                                    <td>
                                        <input type="checkbox" v-model="selectedListings" :value="listing.id" class="custom-checkbox">
                                    </td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-car" style="color: white; font-size: 20px;"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: #1a202c;">[[ listing.Year ]] [[ listing.Make ]]</div>
                                                <div style="color: #718096; font-size: 14px;">[[ listing.Model ]]</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div style="color: #4a5568;">[[ listing['Body Style'] ]]</div>
                                        <div style="color: #718096; font-size: 13px;">[[ listing['Exterior Color'] ]] ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬Ãƒâ€šÃ‚Â¢ [[ listing.Mileage?.toLocaleString() ]] mi</div>
                                    </td>
                                    <td>
                                        <div style="font-size: 18px; font-weight: 700; color: #1a202c;">
                                            $[[ listing.Price?.toLocaleString() ]]
                                        </div>
                                    </td>
                                    
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <button @click="editListing(listing.id)" class="btn btn-secondary" style="padding: 8px 12px;">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button @click="confirmDelete(listing.id)" class="btn btn-danger" style="padding: 8px 12px;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Add Listing Tab -->
            <div v-if="activeTab === 'add-listing'">
                <div class="card" style="max-width: 900px; margin: 0 auto;">
                    <div class="card-header">
                        <div class="card-title">Add New Vehicle Listing</div>
                    </div>
                    <form @submit.prevent="addListing">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label>Year</label>
                                <input v-model.number="newListing.Year" type="number" required placeholder="2024">
                            </div>
                            <div>
                                <label>Make</label>
                                <select v-model="newListing.Make" required>
                                    <option value="">Select Make</option>
                                    <option v-for="make in makeOptions" :key="make" :value="make">[[ make ]]</option>
                                </select>
                            </div>
                            <div>
                                <label>Model</label>
                                <input v-model="newListing.Model" type="text" required placeholder="Civic">
                            </div>
                            <div>
                                <label>Mileage</label>
                                <input v-model.number="newListing.Mileage" type="number" required placeholder="50000">
                            </div>
                            <div>
                                <label>Price</label>
                                <input v-model.number="newListing.Price" type="number" required placeholder="15000">
                            </div>
                            <div>
                                <label>Body Style</label>
                                <select v-model="newListing['Body Style']" required>
                                    <option value="">Select Style</option>
                                    <option v-for="style in bodyStyles" :key="style" :value="style">[[ style ]]</option>
                                </select>
                            </div>
                            <div>
                                <label>Exterior Color</label>
                                <select v-model="newListing['Exterior Color']" required>
                                    <option value="">Select Color</option>
                                    <option v-for="color in colorOptions" :key="color" :value="color">[[ color ]]</option>
                                </select>
                            </div>
                            <div>
                                <label>Interior Color</label>
                                <select v-model="newListing['Interior Color']" required>
                                    <option value="">Select Color</option>
                                    <option v-for="color in colorOptions" :key="color" :value="color">[[ color ]]</option>
                                </select>
                            </div>
                            <div>
                                <label>Condition</label>
                                <select v-model="newListing['Vehicle Condition']" required>
                                    <option value="">Select Condition</option>
                                    <option v-for="condition in conditions" :key="condition" :value="condition">[[ condition ]]</option>
                                </select>
                            </div>
                            <div>
                                <label>Fuel Type</label>
                                <select v-model="newListing['Fuel Type']" required>
                                    <option value="">Select Fuel</option>
                                    <option v-for="fuel in fuelTypes" :key="fuel" :value="fuel">[[ fuel ]]</option>
                                </select>
                            </div>
                            <div>
                                <label>Transmission</label>
                                <select v-model="newListing.Transmission" required>
                                    <option value="">Select Transmission</option>
                                    <option value="Manual transmission">Manual</option>
                                    <option value="Automatic transmission">Automatic</option>
                                </select>
                            </div>
                            <div>
                                <label>Images Path</label>
                                <div style="display: flex; gap: 8px;">
                                    <input v-model="newListing['Images Path']" type="text" required placeholder="Enter folder path or upload files" style="flex: 1;">
                                    <button type="button" @click="openMediaPicker('new')" class="btn btn-primary" style="padding: 10px 16px;" title="Browse Drive">
                                        <i class="fas fa-folder-open"></i>
                                    </button>
                                    <button type="button" @click="openFileUpload('new')" class="btn btn-success" style="padding: 10px 16px;" title="Upload Files">
                                        <i class="fas fa-upload"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label>Description</label>
                            <textarea v-model="newListing.Description" rows="4" required placeholder="Enter detailed vehicle description..."></textarea>
                        </div>
                        <div style="display: flex; justify-content: flex-end; gap: 12px;">
                            <button type="button" @click="resetForm" class="btn btn-secondary">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <button type="submit" class="btn btn-success" style="padding: 12px 32px;">
                                <i class="fas fa-plus-circle"></i> Add Listing
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Media Tab -->
            <div v-if="activeTab === 'media'">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Media Library</div>
                        <div style="display: flex; gap: 12px;">
                            <button @click="createFolderPrompt" class="btn btn-success">
                                <i class="fas fa-folder-plus"></i> New Folder
                            </button>
                            <button @click="openFileUpload('standalone')" class="btn btn-success">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                            <button @click="loadDriveStructure" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div v-if="loadingMedia" class="empty-state">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <p style="font-weight: 600; color: #4a5568;">Loading media files...</p>
                    </div>

                    <!-- Empty State -->
                    <div v-else-if="driveStructure.root.files.length === 0 && driveStructure.folders.length === 0" class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3 style="font-size: 20px; font-weight: 600; color: #1a202c; margin-bottom: 8px;">No files found</h3>
                        <p style="margin-bottom: 24px;">Upload some files to get started</p>
                        <button @click="openFileUpload('standalone')" class="btn btn-success">
                            <i class="fas fa-upload"></i> Upload Files
                        </button>
                    </div>

                    <!-- Content -->
                    <div v-else>
                        <!-- Root Files -->
                        <div v-if="driveStructure.root.files.length > 0" style="margin-bottom: 32px;">
                            <h4 style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-folder-open" style="color: #667eea;"></i>
                                Root Files ([[ driveStructure.root.file_count ]])
                            </h4>
                            <div class="file-grid">
                                <div v-for="file in driveStructure.root.files" :key="file.id" class="file-card">
                                    <div style="aspect-ratio: 1; background: #f1f3f5; border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                        <img v-if="file.thumbnailLink" :src="file.thumbnailLink" :alt="file.name" style="width: 100%; height: 100%; object-fit: cover;">
                                        <i v-else :class="getFileIcon(file.mimeType)" style="font-size: 40px; color: #cbd5e0;"></i>
                                    </div>
                                    <div style="font-size: 13px; font-weight: 600; color: #1a202c; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" :title="file.name">[[ file.name ]]</div>
                                    <div style="font-size: 12px; color: #718096; margin-bottom: 12px;">[[ file.sizeFormatted ]]</div>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                                        <button @click="viewFile(file)" class="btn btn-secondary" style="padding: 6px; font-size: 12px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button @click="confirmDeleteMedia(file)" class="btn btn-danger" style="padding: 6px; font-size: 12px;">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Folders -->
                        <div v-if="driveStructure.folders.length > 0">
                            <h4 style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-folder" style="color: #667eea;"></i>
                                Folders ([[ driveStructure.folders.length ]])
                            </h4>

                            <div v-for="folder in driveStructure.folders" :key="folder.id" 
                                 style="background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin-bottom: 16px;">

                                <!-- Folder Header -->
                                <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;"
                                     @click="toggleFolder(folder.id)">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <i :class="showFolderContent[folder.id] ? 'fas fa-folder-open' : 'fas fa-folder'" 
                                           style="font-size: 24px; color: #667eea;"></i>
                                        <div>
                                            <div style="font-weight: 600; font-size: 16px; color: #1a202c;">[[ folder.name ]]</div>
                                            <div style="color: #718096; font-size: 13px;">[[ folder.file_count ]] file(s)</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <button @click.stop="openFileUploadToFolder(folder.name)" 
                                                class="btn btn-success" 
                                                style="padding: 8px 12px;"
                                                title="Upload to this folder">
                                            <i class="fas fa-upload"></i>
                                        </button>
                                        <button @click.stop="deleteFolder(folder)" 
                                                class="btn btn-danger" 
                                                style="padding: 8px 12px;"
                                                title="Delete folder">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                        <button class="btn btn-secondary" style="padding: 8px 12px;">
                                            <i :class="showFolderContent[folder.id] ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Folder Files (Expanded) -->
                                <div v-if="showFolderContent[folder.id] && folder.files.length > 0" 
                                     style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                                    <div class="file-grid">
                                        <div v-for="file in folder.files" :key="file.id" class="file-card">
                                            <div style="aspect-ratio: 1; background: #f1f3f5; border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                                <img v-if="file.thumbnailLink" :src="file.thumbnailLink" :alt="file.name" style="width: 100%; height: 100%; object-fit: cover;">
                                                <i v-else :class="getFileIcon(file.mimeType)" style="font-size: 40px; color: #cbd5e0;"></i>
                                            </div>
                                            <div style="font-size: 13px; font-weight: 600; color: #1a202c; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" :title="file.name">[[ file.name ]]</div>
                                            <div style="font-size: 12px; color: #718096; margin-bottom: 12px;">[[ file.sizeFormatted ]]</div>
                                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px;">
                                                <button @click="viewFile(file)" class="btn btn-secondary" style="padding: 6px; font-size: 12px;">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button @click="confirmDeleteMedia(file)" class="btn btn-danger" style="padding: 6px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Empty Folder State -->
                                <div v-else-if="showFolderContent[folder.id] && folder.files.length === 0"
                                     style="padding: 30px; text-align: center; color: #718096; background: #f7fafc; border-radius: 8px; margin-top: 16px;">
                                    <i class="fas fa-inbox" style="font-size: 32px; opacity: 0.3; margin-bottom: 8px;"></i>
                                    <p>No files in this folder</p>
                                    <button @click="openFileUploadToFolder(folder.name)" class="btn btn-success" style="margin-top: 12px;">
                                        <i class="fas fa-upload"></i> Upload Files
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- History Tab -->
            <div v-if="activeTab === 'history'">
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Successful</div>
                        <div style="font-size: 32px; font-weight: 700; color: #48bb78;">[[ stats.success ]]</div>
                    </div>
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Failed</div>
                        <div style="font-size: 32px; font-weight: 700; color: #f56565;">[[ stats.failed ]]</div>
                    </div>
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Pending</div>
                        <div style="font-size: 32px; font-weight: 700; color: #ed8936;">[[ stats.pending ]]</div>
                    </div>
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Total</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a202c;">[[ stats.total ]]</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Upload History</div>
                        <button @click="exportHistory" class="btn btn-success">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>

                    <div v-if="loadingHistory" class="empty-state">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <p style="font-weight: 600; color: #4a5568;">Loading history...</p>
                    </div>

                    <div v-else-if="uploadHistory.length === 0" class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3 style="font-size: 20px; font-weight: 600; color: #1a202c; margin-bottom: 8px;">No history found</h3>
                        <p>Upload some listings to see them tracked here</p>
                    </div>

                    <div v-else class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Profile</th>
                                    <th>Facebook Account</th>
                                    <th>Vehicle</th>
                                    <th>Price</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="upload in uploadHistory" :key="upload.id">
                                    <td>
                                        <div style="font-weight: 600; color: #1a202c; font-size: 14px;">[[ formatDate(upload.upload_datetime) ]]</div>
                                        <div style="color: #718096; font-size: 13px;">[[ formatTime(upload.upload_datetime) ]]</div>
                                    </td>
                                    <td>
                                        <div style="font-weight: 600; color: #1a202c;">[[ upload.profile_name ]]</div>
                                        <div style="color: #718096; font-size: 13px;">[[ upload.profile_folder ]]</div>
                                    </td>
                                    <td>
                                        <div v-if="upload.facebook_account_name" style="font-weight: 600; color: #1a202c;">[[ upload.facebook_account_name ]]</div>
                                        <div v-if="upload.facebook_account_email" style="color: #718096; font-size: 13px;">[[ upload.facebook_account_email ]]</div>
                                        <div v-else style="color: #cbd5e0; font-style: italic;">No account tracked</div>
                                    </td>
                                    <td>
                                        <div style="font-weight: 600; color: #1a202c;">
                                            [[ upload.vehicle_info.year ]] [[ upload.vehicle_info.make ]] [[ upload.vehicle_info.model ]]
                                        </div>
                                        <div style="color: #718096; font-size: 13px;">
                                            [[ upload.vehicle_info.mileage?.toLocaleString() ]] mi
                                        </div>
                                    </td>
                                    <td>
                                        <div style="font-size: 18px; font-weight: 700; color: #1a202c;">
                                            $[[ upload.vehicle_info.price?.toLocaleString() ]]
                                        </div>
                                    </td>
                                    <td>[[ upload.location || 'N/A' ]]</td>
                                    <td><span :class="'badge badge-' + getStatusType(upload.status)">[[ upload.status ]]</span></td>
                                    <td>
                                        <button @click="viewDetails(upload)" class="btn btn-secondary" style="padding: 8px 12px;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


            <!-- Schedule Tab -->
            <div v-if="activeTab === 'schedule'">
                <!-- Stats Grid -->
                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Pending</div>
                        <div style="font-size: 32px; font-weight: 700; color: #ed8936;">[[ scheduleStats.pending ]]</div>
                    </div>
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Upcoming (7 days)</div>
                        <div style="font-size: 32px; font-weight: 700; color: #667eea;">[[ scheduleStats.upcoming_7_days ]]</div>
                    </div>
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Completed</div>
                        <div style="font-size: 32px; font-weight: 700; color: #48bb78;">[[ scheduleStats.completed ]]</div>
                    </div>
                    <div class="stat-card">
                        <div style="color: #718096; font-size: 14px; margin-bottom: 4px;">Total</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1a202c;">[[ scheduleStats.total ]]</div>
                    </div>
                </div>

                <!-- Schedule Form Card -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <div class="card-title">Schedule New Post</div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <label>Select Listing</label>
                            <select v-model="scheduleForm.listing_id" required>
                                <option value="">Choose a listing...</option>
                                <option v-for="(listing, index) in listings" :key="index" :value="listing.id">
                                    [[ listing.Year ]] [[ listing.Make ]] [[ listing.Model ]]
                                </option>
                            </select>
                        </div>
                        <div>
                            <label>Select Profile</label>
                            <select v-model="scheduleForm.profile_folder" @change="onScheduleProfileChange" required>
                                <option value="">Choose a profile...</option>
                                <option v-for="profile in profiles" :key="profile.folder_name" :value="profile.folder_name">
                                    [[ profile.user_name ]]
                                </option>
                            </select>
                        </div>
                        <div v-if="scheduleForm.profile_folder && selectedScheduleProfile && selectedScheduleProfile.facebook_accounts && selectedScheduleProfile.facebook_accounts.length > 0">
                            <label>Facebook Account</label>
                            <select v-model="scheduleForm.facebook_account_index">
                                <option value="">Choose account...</option>
                                <option v-for="(account, index) in selectedScheduleProfile.facebook_accounts" :key="index" :value="index">
                                    [[ account.name ]]
                                </option>
                            </select>
                        </div>
                        <div>
                            <label>Schedule Date & Time</label>
                            <input type="datetime-local" v-model="scheduleForm.datetime" required>
                        </div>
                        <div>
                            <label>Recurrence</label>
                            <select v-model="scheduleForm.recurrence">
                                <option value="none">One Time</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button @click="scheduleNewPost" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-calendar-plus"></i> Schedule Post
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Scheduled Posts Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Scheduled Posts</div>
                        <div style="display: flex; gap: 12px;">
                            <button @click="loadScheduledPosts" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div v-if="loadingSchedule" class="empty-state">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <p style="font-weight: 600; color: #4a5568;">Loading scheduled posts...</p>
                    </div>

                    <div v-else-if="scheduledPosts.length === 0" class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <h3 style="font-size: 20px; font-weight: 600; color: #1a202c; margin-bottom: 8px;">No scheduled posts</h3>
                        <p>Schedule your first automated post above</p>
                    </div>

                    <div v-else class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Scheduled For</th>
                                    <th>Profile</th>
                                    <th>Facebook Account</th>
                                    <th>Vehicle</th>
                                    <th>Recurrence</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="post in scheduledPosts" :key="post.id">
                                    <td>
                                        <div style="font-weight: 600; color: #1a202c; font-size: 14px;">
                                            [[ formatDate(post.scheduled_datetime) ]]
                                        </div>
                                        <div style="color: #718096; font-size: 13px;">
                                            [[ formatTime(post.scheduled_datetime) ]]
                                        </div>
                                    </td>
                                    <td>
                                        <div style="font-weight: 600; color: #1a202c;">[[ post.profile_name ]]</div>
                                        <div style="color: #718096; font-size: 13px;">[[ post.profile_folder ]]</div>
                                    </td>
                                    <td>
                                        <div v-if="post.facebook_account_name" style="font-weight: 600; color: #1a202c;">
                                            [[ post.facebook_account_name ]]
                                        </div>
                                        <div v-if="post.facebook_account_email" style="color: #718096; font-size: 13px;">
                                            [[ post.facebook_account_email ]]
                                        </div>
                                        <div v-else style="color: #cbd5e0; font-style: italic;">Not specified</div>
                                    </td>
                                    <td>
                                        <div style="font-weight: 600; color: #1a202c;">
                                            [[ post.vehicle_info.year ]] [[ post.vehicle_info.make ]] [[ post.vehicle_info.model ]]
                                        </div>
                                        <div style="color: #718096; font-size: 13px;">
                                            $[[ post.vehicle_info.price?.toLocaleString() ]]
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge badge-info" style="text-transform: capitalize;">
                                            [[ post.recurrence ]]
                                        </span>
                                    </td>
                                    <td>
                                        <span :class="'badge badge-' + getStatusType(post.status)">
                                            [[ post.status ]]
                                        </span>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <button v-if="post.status === 'pending'" 
                                                    @click="cancelScheduledPost(post.id)" 
                                                    class="btn btn-secondary" 
                                                    style="padding: 8px 12px;">
                                                <i class="fas fa-ban"></i>
                                            </button>
                                            <button @click="deleteScheduledPost(post.id)" 
                                                    class="btn btn-danger" 
                                                    style="padding: 8px 12px;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Logs Section -->
            <div v-if="logs" class="card">
                <div class="card-header">
                    <div class="card-title">Execution Logs</div>
                </div>
                <div style="background: #1a202c; color: #48bb78; padding: 20px; border-radius: 8px; font-family: monospace; font-size: 13px; overflow-x: auto;">
                    <pre style="white-space: pre-wrap; margin: 0;">[[ logs ]]</pre>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div v-if="toast.show" class="toast">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center;" :style="{background: getToastColor(toast.type)}">
                    <i :class="getToastIcon(toast.type)" style="color: white; font-size: 18px;"></i>
                </div>
                <div style="flex: 1;">
                    <p style="font-weight: 600; color: #1a202c;">[[ toast.message ]]</p>
                </div>
                <button @click="toast.show = false" style="color: #718096; background: none; border: none; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Modal (simplified version - you can add edit modal, media picker, etc. following the same pattern) -->
            <!-- Deleted Listings Tab -->
            <div v-if="activeTab === 'deleted'">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Deleted Listings</div>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <span class="badge badge-info">[[ deletedListings.length ]] Total</span>
                            <button @click="loadDeletedListings" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div v-if="loadingDeleted" class="empty-state">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <p style="font-weight: 600; color: #4a5568;">Loading deleted listings...</p>
                    </div>

                    <!-- Empty State -->
                    <div v-else-if="deletedListings.length === 0" class="empty-state">
                        <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                        <h3 style="font-size: 20px; font-weight: 600; color: #1a202c; margin-bottom: 8px;">No Deleted Listings</h3>
                        <p style="color: #718096;">Deleted listings will appear here and can be restored</p>
                    </div>

                    <!-- Deleted Listings Table -->
                    <div v-else class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Details</th>
                                    <th>Price</th>
                                    <th>Deleted</th>
                                    <th style="width: 180px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(listing, index) in deletedListings" :key="listing.id" style="opacity: 0.8;">
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-car" style="color: white; font-size: 20px;"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: #1a202c;">[[ listing.Year ]] [[ listing.Make ]]</div>
                                                <div style="color: #718096; font-size: 14px;">[[ listing.Model ]]</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div style="color: #4a5568;">[[ listing['Body Style'] ]]</div>
                                        <div style="color: #718096; font-size: 13px;">[[ formatNumber(listing.Mileage) ]] miles</div>
                                    </td>
                                    <td style="font-weight: 600; color: #48bb78; font-size: 16px;">
                                        $[[ formatNumber(listing.Price) ]]
                                    </td>
                                    <td>
                                        <div style="font-size: 13px; color: #718096;">
                                            [[ formatDateTime(listing.deleted_at) ]]
                                        </div>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <button @click="restoreListing(listing.id)" class="btn btn-success" style="padding: 8px 16px; font-size: 13px;">
                                                <i class="fas fa-undo"></i> Restore
                                            </button>
                                            <button @click="permanentlyDeleteListing(listing.id)" class="btn btn-danger" style="padding: 8px 16px; font-size: 13px;">
                                                <i class="fas fa-trash"></i> Delete Forever
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        <div v-if="dialog.show" class="fixed inset-0 modal-overlay flex items-center justify-center z-50" @click="dialog.show = false">
            <div class="modal-content" style="padding: 32px;" @click.stop>
                <div style="text-align: center;">
                    <div style="width: 64px; height: 64px; margin: 0 auto 20px; border-radius: 16px; display: flex; align-items: center; justify-content: center;" :style="{background: getToastColor(dialog.type)}">
                        <i :class="getDialogIcon(dialog.type)" style="font-size: 32px; color: white;"></i>
                    </div>
                    <h3 style="font-size: 24px; font-weight: 700; color: #1a202c; margin-bottom: 12px;">[[ dialog.title ]]</h3>
                    <p style="color: #718096; margin-bottom: 24px; font-size: 16px;">[[ dialog.message ]]</p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button v-if="dialog.type === 'confirm'" @click="handleDialogCancel" class="btn btn-secondary">
                            Cancel
                        </button>
                        <button @click="handleDialogConfirm" :class="'btn btn-' + (dialog.type === 'error' ? 'danger' : 'primary')">
                            [[ dialog.confirmText || 'OK' ]]
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Media Picker Modal -->
        <div v-if="showMediaPicker" class="fixed inset-0 modal-overlay flex items-center justify-center z-50" style="padding: 20px;" @click="closeMediaPicker">
            <div class="modal-content" style="padding: 24px; max-width: 1000px; width: 100%;" @click.stop>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 24px; font-weight: 700; color: #1a202c;">Select Media from Google Drive</h3>
                    <button @click="closeMediaPicker" style="background: none; border: none; color: #718096; cursor: pointer; font-size: 24px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div style="margin-bottom: 20px; padding: 12px; background: #f7fafc; border-radius: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                        <input type="checkbox" 
                               v-model="imagePickerMode" 
                               true-value="multi" 
                               false-value="single"
                               @change="selectedImages = []"
                               class="custom-checkbox">
                        <span style="font-weight: 500;">Enable multi-select mode</span>
                        <span v-if="imagePickerMode === 'multi'" class="badge badge-info">
                            [[ selectedImages.length ]] selected
                        </span>
                    </label>
                </div>

                <!-- Search -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 8px;">
                        <input v-model="mediaSearch" @keyup.enter="searchDriveFiles" type="text" placeholder="Search files..." style="flex: 1;">
                        <button @click="searchDriveFiles" class="btn btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                        <button v-if="mediaSearch" @click="clearMediaSearch" class="btn btn-secondary">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading -->
                <div v-if="loadingMedia" class="empty-state" style="padding: 40px;">
                    <div class="spinner" style="margin: 0 auto 20px;"></div>
                    <p style="font-weight: 600; color: #4a5568;">Loading files...</p>
                </div>

                <!-- Files Grid -->
                <div v-else-if="driveFiles.length > 0" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                    <div class="file-grid">
                        <div v-for="file in driveFiles" :key="file.id" 
                             @click="selectMediaForPicker(file)"
                             class="file-card"
                             :class="{'selected': pickerSelected && pickerSelected.id === file.id}">
                            <div style="aspect-ratio: 1; background: #f1f3f5; border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                <img v-if="file.thumbnailLink" :src="file.thumbnailLink" :alt="file.name" style="width: 100%; height: 100%; object-fit: cover;">
                                <i v-else :class="getFileIcon(file.mimeType)" style="font-size: 40px; color: #cbd5e0;"></i>
                            </div>
                            <div style="font-size: 13px; font-weight: 600; color: #1a202c; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" :title="file.name">[[ file.name ]]</div>
                            <div style="font-size: 12px; color: #718096;">[[ file.sizeFormatted ]]</div>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div v-else class="empty-state" style="padding: 40px;">
                    <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                    <p style="color: #718096;">No files found</p>
                </div>

                <!-- Actions -->
                <div style="display: flex; justify-content: space-between; align-items: center; border-top: 2px solid #e2e8f0; padding-top: 20px;">
                    <button @click="openFileUpload('picker')" class="btn btn-success">
                        <i class="fas fa-upload"></i> Upload New File
                    </button>
                    <div style="display: flex; gap: 12px;">
                        <button @click="closeMediaPicker" class="btn btn-secondary">
                            Cancel
                        </button>
                        <button @click="confirmMediaSelection" :disabled="!pickerSelected" class="btn btn-primary">
                            <i class="fas fa-check"></i> Select File
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Upload Modal -->
        <div v-if="showUploadModal" class="fixed inset-0 modal-overlay flex items-center justify-center z-50" style="padding: 20px;" @click="closeUploadModal">
            <div class="modal-content" style="padding: 24px; max-width: 600px; width: 100%;" @click.stop>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 24px; font-weight: 700; color: #1a202c;">Upload to Google Drive</h3>
                    <button @click="closeUploadModal" style="background: none; border: none; color: #718096; cursor: pointer; font-size: 24px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Upload Area -->
                <div style="margin-bottom: 20px;">
                    <div @click="$refs.fileInput.click()" 
                         @dragover.prevent="dragOver = true"
                         @dragleave.prevent="dragOver = false"
                         @drop.prevent="handleFileDrop"
                         class="upload-zone"
                         :class="{'drag-over': dragOver}">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #cbd5e0; margin-bottom: 16px;"></i>
                        <p style="font-weight: 600; color: #4a5568; margin-bottom: 8px;">Click to browse or drag and drop files here</p>
                        <p style="font-size: 14px; color: #718096; margin-bottom: 4px;">Max file size: 100MB</p>
                        <p style="font-size: 14px; color: #718096;">Supported: Images, Videos, ZIP</p>
                    </div>
                    <input type="file" ref="fileInput" @change="handleFileSelect" multiple class="hidden" accept="image/*,video/*,.zip" style="display: none;">
                </div>

                <!-- Upload Progress -->
                <div v-if="uploading" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 14px; color: #4a5568; font-weight: 600;">Uploading...</span>
                        <span style="font-size: 14px; color: #667eea; font-weight: 600;">[[ uploadProgress ]]%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" :style="{width: uploadProgress + '%'}"></div>
                    </div>
                </div>

                <!-- Selected Files -->
                <div v-if="selectedFiles.length > 0 && !uploading" style="margin-bottom: 20px;">
                    <p style="font-size: 14px; font-weight: 600; color: #4a5568; margin-bottom: 12px;">Selected Files ([[ selectedFiles.length ]]):</p>
                    <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e2e8f0; border-radius: 8px; padding: 8px;">
                        <div v-for="(file, index) in selectedFiles" :key="index" style="display: flex; align-items: center; justify-content: space-between; background: #f7fafc; padding: 10px; border-radius: 6px; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; gap: 12px; flex: 1; min-width: 0;">
                                <i class="fas fa-file" style="color: #cbd5e0; font-size: 18px;"></i>
                                <div style="flex: 1; min-width: 0;">
                                    <div style="font-size: 14px; color: #1a202c; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">[[ file.name ]]</div>
                                    <div style="font-size: 12px; color: #718096;">[[ formatBytes(file.size) ]]</div>
                                </div>
                            </div>
                            <button @click="removeFile(index)" style="background: none; border: none; color: #f56565; cursor: pointer; padding: 4px 8px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button @click="closeUploadModal" :disabled="uploading" class="btn btn-secondary">
                        Cancel
                    </button>
                    <button @click="uploadFiles" :disabled="selectedFiles.length === 0 || uploading" class="btn btn-success">
                        <i class="fas fa-upload"></i> Upload ([[ selectedFiles.length ]])
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Listing Modal -->
        <div v-if="editingListing !== null" class="fixed inset-0 modal-overlay flex items-center justify-center z-50" style="padding: 20px;" @click="cancelEdit">
            <div class="modal-content" style="padding: 24px; max-width: 900px; width: 100%;" @click.stop>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 24px; font-weight: 700; color: #1a202c;">Edit Vehicle Listing</h3>
                    <button @click="cancelEdit" style="background: none; border: none; color: #718096; cursor: pointer; font-size: 24px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="updateListing">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label>Year</label>
                            <input v-model.number="editForm.Year" type="number" required>
                        </div>
                        <div>
                            <label>Make</label>
                            <select v-model="editForm.Make" required>
                                <option value="">Select Make</option>
                                <option v-for="make in makeOptions" :key="make" :value="make">[[ make ]]</option>
                            </select>
                        </div>
                        <div>
                            <label>Model</label>
                            <input v-model="editForm.Model" type="text" required>
                        </div>
                        <div>
                            <label>Mileage</label>
                            <input v-model.number="editForm.Mileage" type="number" required>
                        </div>
                        <div>
                            <label>Price</label>
                            <input v-model.number="editForm.Price" type="number" required>
                        </div>
                        <div>
                            <label>Body Style</label>
                            <select v-model="editForm['Body Style']" required>
                                <option value="">Select Style</option>
                                <option v-for="style in bodyStyles" :key="style" :value="style">[[ style ]]</option>
                            </select>
                        </div>
                        <div>
                            <label>Exterior Color</label>
                            <select v-model="editForm['Exterior Color']" required>
                                <option value="">Select Color</option>
                                <option v-for="color in colorOptions" :key="color" :value="color">[[ color ]]</option>
                            </select>
                        </div>
                        <div>
                            <label>Interior Color</label>
                            <select v-model="editForm['Interior Color']" required>
                                <option value="">Select Color</option>
                                <option v-for="color in colorOptions" :key="color" :value="color">[[ color ]]</option>
                            </select>
                        </div>
                        <div>
                            <label>Condition</label>
                            <select v-model="editForm['Vehicle Condition']" required>
                                <option value="">Select Condition</option>
                                <option v-for="condition in conditions" :key="condition" :value="condition">[[ condition ]]</option>
                            </select>
                        </div>
                        <div>
                            <label>Fuel Type</label>
                            <select v-model="editForm['Fuel Type']" required>
                                <option value="">Select Fuel</option>
                                <option v-for="fuel in fuelTypes" :key="fuel" :value="fuel">[[ fuel ]]</option>
                            </select>
                        </div>
                        <div>
                            <label>Transmission</label>
                            <select v-model="editForm.Transmission" required>
                                <option value="">Select Transmission</option>
                                <option value="Manual transmission">Manual</option>
                                <option value="Automatic transmission">Automatic</option>
                            </select>
                        </div>
                        <div>
                            <label>Images Path</label>
                            <div style="display: flex; gap: 8px;">
                                <input v-model="editForm['Images Path']" type="text" required style="flex: 1;">
                                <button type="button" @click="openMediaPicker('edit')" class="btn btn-primary" style="padding: 10px 16px;">
                                    <i class="fas fa-folder-open"></i>
                                </button>
                                <button type="button" @click="openFileUpload('edit')" class="btn btn-success" style="padding: 10px 16px;">
                                    <i class="fas fa-upload"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label>Description</label>
                        <textarea v-model="editForm.Description" rows="4" required></textarea>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label>Selected Day</label>
                        <select v-model="editForm.selectedDay">
                            <option value="">Select Day</option>
                            <option v-for="day in days" :key="day" :value="day">[[ day ]]</option>
                        </select>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 12px;">
                        <button type="button" @click="cancelEdit" class="btn btn-secondary">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            delimiters: ['[[', ']]'],
            data: {
                activeTab: 'dashboard',
                mobileMenuOpen: false,
                profiles: {{ profiles | tojson | safe }},
                listings: {{ listings | tojson | safe }},
                profileLocations: {{ profile_locations | tojson | safe }},
                selectedProfiles: [],
                selectedListings: [],
                maxProfileSelection: 5,
                logs: '',
                isRunning: false,
                uploadHistory: [],
                loadingHistory: false,
                scheduledPosts: [],
                loadingSchedule: false,
                scheduleStats: {
                    pending: 0,
                    completed: 0,
                    failed: 0,
                    cancelled: 0,
                    total: 0,
                    upcoming_7_days: 0
                },
                scheduleForm: {
                    listing_id: '',
                    profile_folder: '',
                    profile_name: '',
                    facebook_account_index: '',
                    datetime: '',
                    recurrence: 'none'
                },
                selectedScheduleProfile: null,
                selectedUpload: null,
                currentPage: 1,
                pageSize: 20,
                totalRecords: 0,
                editingListing: null,
                editForm: {},
                driveFiles: [],
                loadingMedia: false,
                mediaSearch: '',
                driveStats: {},
                showMediaPicker: false,
                showUploadModal: false,
                pickerSelected: null,
                pickerMode: null,
                selectedFiles: [],
                uploading: false,
                uploadProgress: 0,
                dragOver: false,
                filters: {
                    profile: '',
                    status: '',
                    dateFrom: '',
                    dateTo: ''
                },
                stats: {
                    success: 0,
                    failed: 0,
                    pending: 0,
                    in_progress: 0,
                    total: 0
                },
                dialog: {
                    show: false,
                    type: 'info',
                    title: '',
                    message: '',
                    confirmText: 'OK',
                    onConfirm: null,
                    onCancel: null
                },
                toast: {
                    show: false,
                    type: 'success',
                    message: ''
                },
                newListing: {
                    Year: '',
                    Make: '',
                    Model: '',
                    Mileage: '',
                    Price: '',
                    'Body Style': '',
                    'Exterior Color': '',
                    'Interior Color': '',
                    'Vehicle Condition': '',
                    'Fuel Type': '',
                    Transmission: '',
                    Description: '',
                    'Images Path': '',
                    'selectedDay': '',
                    image_ids: [],
                    image_folder: ''
                },
                days: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                colorOptions: [
                    'Black', 'Blue', 'Brown', 'Gold', 'Green', 'Gray', 'Pink', 'Purple',
                    'Red', 'Silver', 'Orange', 'White', 'Yellow', 'Charcoal', 'Off white',
                    'Tan', 'Beige', 'Burgundy', 'Turquoise'
                ],
                makeOptions: [
                    'Acura', 'Alfa Romeo', 'Aston Martin', 'Audi', 'BMW', 'Bentley', 'Buick',
                    'Cadillac', 'Chevrolet', 'Chrysler', 'Dodge', 'Ferrari', 'Fiat', 'Ford',
                    'GMC', 'Genesis', 'Honda', 'Hyundai', 'Infiniti', 'Jaguar', 'Jeep',
                    'Kia', 'Lamborghini', 'Land Rover', 'Lexus', 'Lincoln', 'Maserati',
                    'Mazda', 'Mercedes-Benz', 'Mini', 'Mitsubishi', 'Nissan', 'Porsche',
                    'Ram', 'Subaru', 'Tesla', 'Toyota', 'Volkswagen', 'Volvo'
                ],
                bodyStyles: [
                    'Sedan', 'SUV', 'Coupe', 'Truck', 'Hatchback', 'Convertible',
                    'Wagon', 'Minivan', 'Small Car', 'Other'
                ],
                conditions: [
                    'Excellent', 'Very good', 'Good', 'Fair', 'Poor'
                ],
                fuelTypes: [
                    'Diesel', 'Electric', 'Gasoline', 'Flex', 'Hybrid', 
                    'Petrol', 'Plug-in hybrid', 'Other'
                ],
                driveStructure: {
        root: { id: '', name: '', file_count: 0, files: [] },
        folders: []
    },
    showFolderContent: {},
    imagePickerMode: 'single',
    selectedImages: [],
    currentFolder: '',
    imagePreviews: [],
                    deletedListings: [],
                showDeletedListings: false,
                loadingDeleted: false,
                profileNotifications: {},
                checkingNotifications: false,
    
                },

            computed: {
                hasSelections() {
                    return this.selectedProfiles.length > 0 && this.selectedListings.length > 0;
                },
                allListingsSelected() {
                    return this.listings.length > 0 && this.selectedListings.length === this.listings.length;
                }
            },
            methods: {
                getPageTitle() {
                    const titles = {
                        'dashboard': 'Dashboard',
                        'profiles': 'Chrome Profiles',
                        'listings': 'Vehicle Listings',
                        'add-listing': 'Add New Listing',
                        'media': 'Media Library',
                        'history': 'Upload History',
                        'deleted': 'Deleted Listings'
                    };
                    return titles[this.activeTab] || 'Dashboard';
                },
                getPageSubtitle() {
                    const subtitles = {
                        'dashboard': 'Overview of your marketplace automation',
                        'profiles': 'Manage your Chrome profiles for posting',
                        'listings': 'Manage your vehicle listings',
                        'add-listing': 'Create a new vehicle listing',
                        'media': 'Manage your media files in Google Drive',
                        'history': 'View upload history and statistics',
                        'deleted': 'Restore previously deleted listings'
                    };
                    return subtitles[this.activeTab] || '';
                },
                isProfileSelected(profile) {
                    return this.selectedProfiles.some(p => p.folder_name === profile.folder_name);
                },
                onProfileCheckboxChange(event, profile) {
                    const isChecked = event.target.checked;
                    
                    if (isChecked) {
                        if (this.selectedProfiles.length >= this.maxProfileSelection) {
                            event.preventDefault();
                            event.target.checked = false;
                            this.showDialog('warning', 'Selection Limit Reached', 
                                `You can only select up to ${this.maxProfileSelection} profiles at a time.`);
                            return false;
                        }
                        this.selectedProfiles.push(profile);
                    } else {
                        this.selectedProfiles = this.selectedProfiles.filter(p => p.folder_name !== profile.folder_name);
                    }
                },
                toggleFacebookAccount(profileFolderName, accountIndex) {
                    // Find the profile
                    const profile = this.profiles.find(p => p.folder_name === profileFolderName);
                    if (profile && profile.facebook_accounts && profile.facebook_accounts[accountIndex]) {
                        // Toggle the selected state
                        profile.facebook_accounts[accountIndex].selected = !profile.facebook_accounts[accountIndex].selected;
                        
                        // Force Vue to update
                        this.$forceUpdate();
                    }
                },
                showDialog(type, title, message, confirmText = 'OK') {
                    return new Promise((resolve) => {
                        this.dialog = {
                            show: true,
                            type: type,
                            title: title,
                            message: message,
                            confirmText: confirmText,
                            onConfirm: () => {
                                this.dialog.show = false;
                                resolve(true);
                            },
                            onCancel: () => {
                                this.dialog.show = false;
                                resolve(false);
                            }
                        };
                    });
                },
                handleDialogConfirm() {
                    if (this.dialog.onConfirm) this.dialog.onConfirm();
                },
                handleDialogCancel() {
                    if (this.dialog.onCancel) this.dialog.onCancel();
                },
                getDialogIcon(type) {
                    const icons = {
                        'success': 'fas fa-check-circle',
                        'error': 'fas fa-times-circle',
                        'warning': 'fas fa-exclamation-triangle',
                        'info': 'fas fa-info-circle',
                        'confirm': 'fas fa-question-circle'
                    };
                    return icons[type] || icons['info'];
                },
                showToast(type, message, duration = 3000) {
                    this.toast = { show: true, type: type, message: message };
                    setTimeout(() => { this.toast.show = false; }, duration);
                },
                getToastIcon(type) {
                    const icons = {
                        'success': 'fas fa-check-circle',
                        'error': 'fas fa-times-circle',
                        'warning': 'fas fa-exclamation-triangle',
                        'info': 'fas fa-info-circle'
                    };
                    return icons[type] || icons['info'];
                },
                getToastColor(type) {
                    const colors = {
                        'success': 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)',
                        'error': 'linear-gradient(135deg, #f56565 0%, #e53e3e 100%)',
                        'warning': 'linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)',
                        'info': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'confirm': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                    };
                    return colors[type] || colors['info'];
                },
                updateProfileLocation(folderName) {
                    axios.post('/update_profile_location', {
                        profile: folderName,
                        location: this.profileLocations[folderName]
                    })
                    .then(response => {
                        if (response.data.status === 'success') {
                            this.showToast('success', 'Location updated!');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        this.showDialog('error', 'Error', 'Failed to update location.');
                    });
                },
                resetForm() {
                    this.newListing = {
                        Year: '', Make: '', Model: '', Mileage: '', Price: '',
                        'Body Style': '', 'Exterior Color': '', 'Interior Color': '',
                        'Vehicle Condition': '', 'Fuel Type': '', Transmission: '',
                        Description: '', 'Images Path': '', 'selectedDay': ''
                    };
                    this.showToast('info', 'Form reset');
                },
                addListing() {
                    axios.post('/add_listing', this.newListing)
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.listings.push({...this.newListing});
                                this.resetForm();
                                this.showDialog('success', 'Success!', 'Listing added successfully!');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            this.showDialog('error', 'Error', 'Failed to add listing.');
                        });
                },
                editListing(index) {
                    this.editingListing = index;
                    this.editForm = JSON.parse(JSON.stringify(this.listings[index]));
                },
                cancelEdit() {
                    this.editingListing = null;
                    this.editForm = {};
                },
                updateListing() {
                    axios.post('/update_listing', this.editForm)
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.listings[this.editingListing] = {...this.editForm};
                                this.cancelEdit();
                                this.showDialog('success', 'Updated!', 'Listing updated successfully!');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            this.showDialog('error', 'Error', 'Failed to update listing.');
                        });
                },
                async confirmDelete(index) {
                    const confirmed = await this.showDialog('confirm', 'Confirm Delete', 'Delete this listing?', 'Delete');
                    if (!confirmed) return;
                    
                    try {
                        const response = await axios.post('/delete_listing', { index: index });
                        
                        if (response.data.status === 'success') {
                            // Remove from active listings
                            this.listings.splice(index, 1);
                            
                            // Show success message
                            this.showToast('success', 'Listing moved to deleted listings');
                            
                            // ✅ CRITICAL FIX: Reload deleted listings
                            await this.loadDeletedListings();
                            
                        } else {
                            this.showToast('error', response.data.message || 'Failed to delete listing');
                        }
                    } catch (error) {
                        console.error('Error deleting listing:', error);
                        const errorMessage = error.response?.data?.message || 'Failed to delete listing';
                        this.showDialog('error', 'Error', errorMessage);
                    }
                },
                toggleAllListings(event) {
                    if (event.target.checked) {
                        this.selectedListings = this.listings.map((_, index) => index);
                    } else {
                        this.selectedListings = [];
                    }
                },
                async runBot() {
                    if (!this.hasSelections) {
                        await this.showDialog('warning', 'No Selection', 'Please select profiles and listings.');
                        return;
                    }
                    
                    const confirmed = await this.showDialog('confirm', 'Launch Bot', 
                        `Ready to post ${this.selectedListings.length} listing(s) with ${this.selectedProfiles.length} profile(s)?`, 'Launch');
                    if (!confirmed) return;

                    this.isRunning = true;
                    this.logs = 'Initializing bot...\n';
                    this.showToast('info', 'Bot started!');
                    
                    const listingsData = this.selectedListings.map(index => ({
                        ...this.listings[index],
                        selectedDay: this.listings[index].selectedDay
                    }));
                    
                    axios.post('/run_bot', {
                        profiles: this.selectedProfiles,
                        listings: this.selectedListings,
                        listingsData: listingsData
                    })
                    .then(response => {
                        this.logs += response.data.stdout;
                        if (response.data.stderr) {
                            this.logs += '\nErrors:\n' + response.data.stderr;
                        }
                        this.showDialog('success', 'Complete!', 'Bot execution completed!');
                    })
                    .catch(error => {
                        const errorMsg = error.response?.data?.message || 'An error occurred';
                        this.logs += '\nError: ' + errorMsg;
                        this.showDialog('error', 'Bot Error', errorMsg);
                    })
                    .finally(() => {
                        this.isRunning = false;
                    });
                },
                loadUploadHistory() {
                    this.loadingHistory = true;
                    axios.get('/upload_history', { params: {page: this.currentPage, page_size: this.pageSize, ...this.filters} })
                        .then(response => {
                            this.uploadHistory = response.data.uploads;
                            this.totalRecords = response.data.total;
                            this.stats = response.data.stats;
                        })
                        .finally(() => {
                            this.loadingHistory = false;
                        });
                },
                viewDetails(upload) {
                    this.selectedUpload = upload;
                },
                exportHistory() {
                    const params = new URLSearchParams(this.filters);
                    window.open(`/export_history?${params.toString()}`, '_blank');
                    this.showToast('success', 'Export started!');
                },
                getStatusType(status) {
                    const types = {
                        'success': 'success',
                        'failed': 'error',
                        'pending': 'warning',
                        'in_progress': 'info'
                    };
                    return types[status] || 'info';
                },
                loadDriveFiles() {
                    console.log('Loading Google Drive files...');
                    this.loadingMedia = true;
                    axios.get('/list_drive_files')
                        .then(response => {
                            console.log('Drive files response:', response.data);
                            if (response.data.status === 'success') {
                                this.driveFiles = response.data.files;
                                console.log(`Loaded ${this.driveFiles.length} files from Google Drive`);
                                this.loadDriveStats();
                            } else {
                                console.error('Failed to load files:', response.data);
                                this.showToast('error', response.data.message || 'Failed to load files');
                            }
                        })
                        .catch(error => {
                            console.error('Error loading files:', error);
                            const errorMsg = error.response?.data?.message || error.message || 'Failed to load files';
                            this.showDialog('error', 'Google Drive Error', errorMsg);
                        })
                        .finally(() => {
                            this.loadingMedia = false;
                        });
                },
                loadDriveStats() {
                    axios.get('/get_drive_stats')
                        .then(response => {
                            console.log('Drive stats:', response.data);
                            if (response.data.status === 'success') {
                                this.driveStats = response.data.stats;
                            }
                        })
                        .catch(error => {
                            console.error('Error loading stats:', error);
                        });
                },
                viewFile(file) {
                    window.open(file.webViewLink, '_blank');
                },
                async confirmDeleteMedia(file) {
                    const confirmed = await this.showDialog('confirm', 'Delete File', `Delete "${file.name}"?`, 'Delete');
                    if (confirmed) {
                        axios.post('/delete_drive_file', { file_id: file.id })
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.showToast('success', 'File deleted!');
                                // Reload structure if in media tab, otherwise reload files list
                                if (this.activeTab === 'media') {
                                    this.loadDriveStructure();
                                } else {
                                    this.loadDriveFiles();
                                }
                            }
                        });
                    }
                },
                openMediaPicker(mode) {
                    this.pickerMode = mode;
                    this.showMediaPicker = true;
                    this.pickerSelected = null;
                    if (this.driveFiles.length === 0) {
                        this.loadDriveFiles();
                    }
                },
                closeMediaPicker() {
                    this.showMediaPicker = false;
                    this.pickerSelected = null;
                    this.mediaSearch = '';
                },
                selectMediaForPicker(file) {
                    this.pickerSelected = file;
                },
                confirmMediaSelection() {
                    if (!this.pickerSelected) return;
                    
                    // Use the file's web view link or construct a path
                    const filePath = this.pickerSelected.webViewLink || `https://drive.google.com/uc?id=${this.pickerSelected.id}`;
                    
                    if (this.pickerMode === 'new') {
                        this.newListing['Images Path'] = filePath;
                    } else if (this.pickerMode === 'edit') {
                        this.editForm['Images Path'] = filePath;
                    }
                    
                    this.closeMediaPicker();
                    this.showToast('success', 'Media file selected!');
                },
                searchDriveFiles() {
                    if (!this.mediaSearch.trim()) {
                        this.loadDriveFiles();
                        return;
                    }
                    this.loadingMedia = true;
                    axios.get('/search_drive_files', { params: { q: this.mediaSearch } })
                    .then(response => {
                        if (response.data.status === 'success') {
                            this.driveFiles = response.data.files;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        this.showToast('error', 'Search failed');
                    })
                    .finally(() => {
                        this.loadingMedia = false;
                    });
                },
                clearMediaSearch() {
                    this.mediaSearch = '';
                    this.loadDriveFiles();
                },
                // ========================================================================
                // FOLDER MANAGEMENT METHODS FOR MEDIA LIBRARY
                // ========================================================================
                
                loadDriveStructure() {
                    console.log('Loading Google Drive folder structure...');
                    this.loadingMedia = true;
                    axios.get('/get_drive_structure')
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.driveStructure = response.data.structure;
                                console.log(`Loaded structure: ${this.driveStructure.folders.length} folders`);
                                // Initialize showFolderContent for each folder
                                this.driveStructure.folders.forEach(folder => {
                                    this.$set(this.showFolderContent, folder.id, false);
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Error loading structure:', error);
                            this.showToast('error', 'Failed to load folder structure');
                        })
                        .finally(() => {
                            this.loadingMedia = false;
                        });
                },
                
                toggleFolder(folderId) {
                    this.$set(this.showFolderContent, folderId, !this.showFolderContent[folderId]);
                },
                
                async createFolderPrompt() {
                    const folderName = prompt('Enter folder name (e.g., 2024-Honda-Civic):');
                    if (!folderName || !folderName.trim()) {
                        return;
                    }
                    
                    try {
                        const response = await axios.post('/create_drive_folder', {
                            folder_name: folderName.trim()
                        });
                        
                        if (response.data.status === 'success') {
                            this.showToast('success', `Folder "${folderName}" created!`);
                            this.loadDriveStructure();
                        }
                    } catch (error) {
                        console.error('Error creating folder:', error);
                        this.showDialog('error', 'Error', 
                            error.response?.data?.message || 'Failed to create folder');
                    }
                },
                
                async deleteFolder(folder) {
                    const confirmed = await this.showDialog('confirm', 'Delete Folder?', 
                        `Delete "${folder.name}" and all its files?`, 'Delete');
                    if (!confirmed) return;
                    
                    try {
                        const response = await axios.post('/delete_drive_folder', {
                            folder_id: folder.id
                        });
                        
                        if (response.data.status === 'success') {
                            this.showToast('success', 'Folder deleted');
                            this.loadDriveStructure();
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.showToast('error', 'Failed to delete folder');
                    }
                },
                
                openFileUploadToFolder(folderName) {
                    this.currentFolder = folderName;
                    this.pickerMode = 'standalone';
                    this.showUploadModal = true;
                    this.selectedFiles = [];
                    this.uploadProgress = 0;
                },
openFileUpload(mode) {
                    this.currentFolder = '';  // Reset folder when opening upload modal
                    this.pickerMode = mode;
                    this.showUploadModal = true;
                    this.selectedFiles = [];
                    this.uploadProgress = 0;
                },
                closeUploadModal() {
                    if (!this.uploading) {
                        this.showUploadModal = false;
                        this.selectedFiles = [];
                        this.uploadProgress = 0;
                        this.currentFolder = '';  // Reset current folder
                    }
                },
                handleFileSelect(event) {
                    const files = Array.from(event.target.files);
                    this.selectedFiles = [...this.selectedFiles, ...files];
                },
                handleFileDrop(event) {
                    this.dragOver = false;
                    const files = Array.from(event.dataTransfer.files);
                    this.selectedFiles = [...this.selectedFiles, ...files];
                },
                removeFile(index) {
                    this.selectedFiles.splice(index, 1);
                },
                uploadFiles() {
                    if (this.selectedFiles.length === 0) {
                        this.showToast('warning', 'No files selected');
                        return;
                    }
                    
                    this.uploading = true;
                    this.uploadProgress = 0;
                    
                    const totalFiles = this.selectedFiles.length;
                    let uploadedCount = 0;
                    let lastUploadedFile = null;
                    
                    const uploadNext = (index) => {
                        if (index >= this.selectedFiles.length) {
                            this.uploading = false;
                            this.uploadProgress = 100;
                            
                            // Show success message
                            this.showDialog('success', 'Upload Complete', `Successfully uploaded ${uploadedCount} of ${totalFiles} file(s)!`);
                            
                            // If uploading from picker or new/edit listing, set the last uploaded file
                            if (lastUploadedFile && (this.pickerMode === 'new' || this.pickerMode === 'edit' || this.pickerMode === 'picker')) {
                                const filePath = lastUploadedFile.webViewLink || `https://drive.google.com/uc?id=${lastUploadedFile.id}`;
                                
                                if (this.pickerMode === 'new') {
                                    this.newListing['Images Path'] = filePath;
                                    this.showToast('success', 'Path set to uploaded file!');
                                } else if (this.pickerMode === 'edit') {
                                    this.editForm['Images Path'] = filePath;
                                    this.showToast('success', 'Path set to uploaded file!');
                                } else if (this.pickerMode === 'picker') {
                                    // Close picker modal and select the file
                                    this.pickerSelected = lastUploadedFile;
                                    this.confirmMediaSelection();
                                }
                            }
                            
                            // Close upload modal and refresh files
                            this.closeUploadModal();
                            if (this.activeTab === 'media') {
                                this.loadDriveStructure();
                            } else {
                                this.loadDriveFiles();
                            }
                            return;
                        }
                        
                        const file = this.selectedFiles[index];
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        // Add folder name if uploading to a specific folder
                        if (this.currentFolder) {
                            formData.append('folder_name', this.currentFolder);
                            console.log(`Uploading file ${index + 1}/${totalFiles} to folder "${this.currentFolder}": ${file.name}`);
                        } else {
                            console.log(`Uploading file ${index + 1}/${totalFiles}: ${file.name}`);
                        }
                        
                        axios.post('/upload_to_drive', formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            },
                            timeout: 120000 // 2 minute timeout
                        })
                        .then(response => {
                            console.log('Upload response:', response.data);
                            if (response.data.status === 'success') {
                                uploadedCount++;
                                lastUploadedFile = response.data.file;
                                this.uploadProgress = Math.round(((index + 1) / totalFiles) * 100);
                                this.showToast('success', `Uploaded: ${file.name}`);
                                uploadNext(index + 1);
                            } else {
                                console.error('Upload failed:', response.data);
                                this.showToast('error', `Failed: ${file.name} - ${response.data.message}`);
                                uploadNext(index + 1);
                            }
                        })
                        .catch(error => {
                            console.error('Upload error:', error);
                            const errorMsg = error.response?.data?.message || error.message || 'Unknown error';
                            this.showToast('error', `Failed: ${file.name} - ${errorMsg}`);
                            uploadNext(index + 1);
                        });
                    };
                    
                    uploadNext(0);
                },
                formatBytes(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
                },
                getFileIcon(mimeType) {
                    if (!mimeType) return 'fas fa-file';
                    if (mimeType.startsWith('image/')) return 'fas fa-file-image';
                    if (mimeType.startsWith('video/')) return 'fas fa-file-video';
                    return 'fas fa-file';
                },
                formatDate(datetime) {
                    if (!datetime) return 'N/A';
                    return new Date(datetime).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                },
                formatTime(datetime) {
                    if (!datetime) return 'N/A';
                    return new Date(datetime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                },
                
                // Schedule methods
                loadScheduledPosts() {
                    this.loadingSchedule = true;
                    axios.get('/get_scheduled_posts')
                        .then(response => {
                            this.scheduledPosts = response.data.scheduled_posts;
                            this.loadScheduleStats();
                        })
                        .catch(error => {
                            console.error('Error loading scheduled posts:', error);
                            this.showToast('error', 'Failed to load scheduled posts');
                        })
                        .finally(() => {
                            this.loadingSchedule = false;
                        });
                },
                
                loadScheduleStats() {
                    axios.get('/get_schedule_stats')
                        .then(response => {
                            this.scheduleStats = response.data.stats;
                        })
                        .catch(error => {
                            console.error('Error loading schedule stats:', error);
                        });
                },
                
                onScheduleProfileChange() {
                    this.selectedScheduleProfile = this.profiles.find(
                        p => p.folder_name === this.scheduleForm.profile_folder
                    );
                    if (this.selectedScheduleProfile) {
                        this.scheduleForm.profile_name = this.selectedScheduleProfile.user_name;
                    }
                    this.scheduleForm.facebook_account_index = '';
                },
                
                scheduleNewPost() {
                    if (!this.scheduleForm.listing_id || !this.scheduleForm.profile_folder || !this.scheduleForm.datetime) {
                        this.showToast('warning', 'Please fill in all required fields');
                        return;
                    }
                    
                    // Get Facebook account info if selected
                    let fbAccountName = null;
                    let fbAccountEmail = null;
                    if (this.scheduleForm.facebook_account_index !== '' && this.selectedScheduleProfile) {
                        const account = this.selectedScheduleProfile.facebook_accounts[this.scheduleForm.facebook_account_index];
                        if (account) {
                            fbAccountName = account.name;
                            fbAccountEmail = account.email;
                        }
                    }
                    
                    const scheduleData = {
                        listing_id: this.scheduleForm.listing_id,
                        profile_folder: this.scheduleForm.profile_folder,
                        profile_name: this.scheduleForm.profile_name,
                        facebook_account_name: fbAccountName,
                        facebook_account_email: fbAccountEmail,
                        scheduled_datetime: new Date(this.scheduleForm.datetime).toISOString(),
                        recurrence: this.scheduleForm.recurrence
                    };
                    
                    axios.post('/schedule_post', scheduleData)
                        .then(response => {
                            this.showDialog('success', 'Success!', 'Post scheduled successfully');
                            this.loadScheduledPosts();
                            // Reset form
                            this.scheduleForm = {
                                listing_id: '',
                                profile_folder: '',
                                profile_name: '',
                                facebook_account_index: '',
                                datetime: '',
                                recurrence: 'none'
                            };
                            this.selectedScheduleProfile = null;
                        })
                        .catch(error => {
                            console.error('Error scheduling post:', error);
                            this.showDialog('error', 'Error', error.response?.data?.message || 'Failed to schedule post');
                        });
                },
                
                async cancelScheduledPost(scheduleId) {
                    const confirmed = await this.showDialog('confirm', 'Cancel Schedule', 
                        'Are you sure you want to cancel this scheduled post?', 'Cancel Post');
                    if (confirmed) {
                        axios.post('/update_scheduled_post', {
                            schedule_id: scheduleId,
                            status: 'cancelled'
                        })
                        .then(response => {
                            this.showToast('success', 'Scheduled post cancelled');
                            this.loadScheduledPosts();
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            this.showToast('error', 'Failed to cancel scheduled post');
                        });
                    }
                },
                
                async deleteScheduledPost(scheduleId) {
                    const confirmed = await this.showDialog('confirm', 'Delete Schedule', 
                        'Are you sure you want to delete this scheduled post?', 'Delete');
                    if (confirmed) {
                        axios.post('/delete_scheduled_post', {
                            schedule_id: scheduleId
                        })
                        .then(response => {
                            this.showToast('success', 'Scheduled post deleted');
                            this.loadScheduledPosts();
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            this.showToast('error', 'Failed to delete scheduled post');
                        });
                    }
                }
            },
                // ========================================================================
                // NOTIFICATIONS METHODS
                // ========================================================================
                
                async checkNotifications(profileFolder) {
                    if (this.checkingNotifications) {
                        return;
                    }
                    
                    this.checkingNotifications = true;
                    this.showToast('info', 'Checking notifications...');
                    
                    try {
                        const response = await axios.get(`/check_notifications/${profileFolder}`);
                        
                        if (response.data.status === 'success') {
                            // Update profile notifications data
                            this.$set(this.profileNotifications, profileFolder, response.data);
                            
                            const count = response.data.notification_count;
                            if (count > 0) {
                                this.showToast('success', `Found ${count} notification(s)!`);
                            } else {
                                this.showToast('info', 'No new notifications');
                            }
                        } else {
                            this.showToast('warning', response.data.message || 'Could not check notifications');
                        }
                    } catch (error) {
                        console.error('Error checking notifications:', error);
                        this.showToast('error', 'Failed to check notifications');
                    } finally {
                        this.checkingNotifications = false;
                    }
                },
                
                loadAllNotifications() {
                    // Load cached notification data for all profiles
                    axios.get('/get_all_notifications')
                        .then(response => {
                            if (response.data.status === 'success') {
                                response.data.notifications.forEach(notif => {
                                    this.$set(this.profileNotifications, notif.profile_folder, notif);
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Error loading notifications:', error);
                        });
                },
                
                // ========================================================================
                // DELETED LISTINGS METHODS
                // ========================================================================
                
                loadDeletedListings() {
                    this.loadingDeleted = true;
                    
                    axios.get('/get_deleted_listings')
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.deletedListings = response.data.deleted_listings;
                                console.log(`✅ Loaded ${this.deletedListings.length} deleted listings`);
                            } else {
                                this.showToast('error', 'Failed to load deleted listings');
                            }
                        })
                        .catch(error => {
                            console.error('❌ Error loading deleted listings:', error);
                            const errorMessage = error.response?.data?.message || 'Failed to load deleted listings';
                            this.showToast('error', errorMessage);
                        })
                        .finally(() => {
                            this.loadingDeleted = false;
                        });
                },
                
                async restoreListing(listingId) {
                    const confirmed = await this.showDialog('confirm', 'Restore Listing', 
                        'Restore this listing to active listings?', 'Restore');
                    if (!confirmed) return;
                    
                    try {
                        const response = await axios.post('/restore_listing', { id: listingId });
                        
                        if (response.data.status === 'success') {
                            this.showToast('success', 'Listing restored successfully!');
                            
                            // Remove from deleted list
                            this.deletedListings = this.deletedListings.filter(l => l.id !== listingId);
                            
                            // ✅ Reload active listings to show the restored item
                            this.loadListings();
                            
                        } else {
                            this.showToast('error', response.data.message || 'Failed to restore listing');
                        }
                    } catch (error) {
                        console.error('Error restoring listing:', error);
                        const errorMessage = error.response?.data?.message || 'Failed to restore listing';
                        this.showToast('error', errorMessage);
                    }
                },
                
                async permanentlyDeleteListing(listingId) {
                    const confirmed = await this.showDialog('confirm', 'Permanently Delete', 
                        'Are you sure? This action cannot be undone!', 'Delete Forever');
                    if (!confirmed) return;
                    
                    // Double confirmation for permanent delete
                    const doubleConfirmed = await this.showDialog('confirm', 'Final Confirmation', 
                        'This will PERMANENTLY delete the listing. Are you absolutely sure?', 'Yes, Delete Forever');
                    if (!doubleConfirmed) return;
                    
                    try {
                        const response = await axios.post('/permanently_delete_listing', { id: listingId });
                        
                        if (response.data.status === 'success') {
                            this.showToast('success', 'Listing permanently deleted');
                            
                            // Remove from deleted list
                            this.deletedListings = this.deletedListings.filter(l => l.id !== listingId);
                            
                        } else {
                            this.showToast('error', response.data.message || 'Failed to permanently delete');
                        }
                    } catch (error) {
                        console.error('Error permanently deleting listing:', error);
                        const errorMessage = error.response?.data?.message || 'Failed to permanently delete listing';
                        this.showToast('error', errorMessage);
                    }
                },
                
                // ========================================================================
                // HELPER METHODS
                // ========================================================================
                
                formatDateTime(datetime) {
                    if (!datetime) return 'N/A';
                    try {
                        const date = new Date(datetime);
                        return date.toLocaleString('en-US', { 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (e) {
                        return 'N/A';
                    }
                },
                
                formatNumber(num) {
                    if (!num) return '0';
                    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                },
                
                loadListings() {
                    // Reload active listings
                    axios.get('/get_listings')
                        .then(response => {
                            if (response.data.status === 'success') {
                                this.listings = response.data.listings;
                            }
                        })
                        .catch(error => {
                            console.error('Error loading listings:', error);
                        });
                },
                

            mounted() {
                // Load initial data
                if (this.uploadHistory.length === 0) {
                    this.loadUploadHistory();
                }
                // Load cached notifications
                this.loadAllNotifications();
                // ✅ Load deleted listings on startup
                this.loadDeletedListings();
            }
        });
    </script>
</body>
</html>